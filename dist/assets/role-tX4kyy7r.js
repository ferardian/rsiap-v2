import{d as u}from"./vendor-abe1rO6K.js";import{p as o,e as l}from"./index-CXPIpl-L.js";const d=u("role",{state:()=>({roles:[],userRoles:[],pegawai:[],loading:!1,error:null,selectedRole:null}),getters:{rolesWithUserCount:a=>a.roles.map(r=>{var s;return{...r,user_count:a.userRoles.filter(e=>e.id_role===r.id_role).length,menu_count:r.menu_count||((s=r.menus)==null?void 0:s.length)||0}}),getRoleById:a=>r=>a.roles.find(s=>s.id_role===r),getUsersInRole:a=>r=>{const s=a.userRoles.filter(e=>e.id_role===r).map(e=>e.nip);return a.pegawai.filter(e=>s.includes(e.nip))},getPegawaiNotInRole:a=>r=>{const s=a.userRoles.filter(e=>e.id_role===r).map(e=>e.nip);return a.pegawai.filter(e=>!s.includes(e.nip))}},actions:{async fetchAllRoles(a={}){var r,s;this.loading=!0,this.error=null;try{const e=await l.getAllAccessLevels(a);return this.roles=e.data||[],{success:!0,data:this.roles}}catch(e){return this.error=((s=(r=e.response)==null?void 0:r.data)==null?void 0:s.message)||"Gagal mengambil data role",{success:!1,error:this.error}}finally{this.loading=!1}},async fetchRolesWithPegawai(){var a,r;this.loading=!0,this.error=null;try{const s=await l.getAccessLevelsWithPegawai();return this.roles=s.data||[],{success:!0,data:this.roles}}catch(s){return this.error=((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.message)||"Gagal mengambil data role dengan pegawai",{success:!1,error:this.error}}finally{this.loading=!1}},async createRole(a){var r,s;this.loading=!0,this.error=null;try{const e=await l.createAccessLevel(a);return this.roles.push(e.data),{success:!0,data:e.data}}catch(e){return this.error=((s=(r=e.response)==null?void 0:r.data)==null?void 0:s.message)||"Gagal membuat role",{success:!1,error:this.error}}finally{this.loading=!1}},async updateRole(a,r){var s,e;this.loading=!0,this.error=null;try{const t=await l.updateAccessLevel(a,r),i=this.roles.findIndex(n=>n.id_role===a);return i!==-1&&(this.roles[i]={...this.roles[i],...t.data}),{success:!0,data:t.data}}catch(t){return this.error=((e=(s=t.response)==null?void 0:s.data)==null?void 0:e.message)||"Gagal update role",{success:!1,error:this.error}}finally{this.loading=!1}},async deleteRole(a){var r,s;this.loading=!0,this.error=null;try{return await l.deleteAccessLevel(a),this.roles=this.roles.filter(e=>e.id_role!==a),this.userRoles=this.userRoles.filter(e=>e.id_role!==a),{success:!0}}catch(e){return this.error=((s=(r=e.response)==null?void 0:r.data)==null?void 0:s.message)||"Gagal hapus role",{success:!1,error:this.error}}finally{this.loading=!1}},async getRole(a){var r,s;this.loading=!0,this.error=null;try{const e=await l.getAccessLevel(a);return this.selectedRole=e.data,{success:!0,data:e.data}}catch(e){return this.error=((s=(r=e.response)==null?void 0:r.data)==null?void 0:s.message)||"Gagal mengambil detail role",{success:!1,error:this.error}}finally{this.loading=!1}},async getRolePermissions(a){var r,s;this.loading=!0,this.error=null;try{return{success:!0,data:(await l.getAccessLevelPermissions(a)).data}}catch(e){return this.error=((s=(r=e.response)==null?void 0:r.data)==null?void 0:s.message)||"Gagal mengambil permissions role",{success:!1,error:this.error}}finally{this.loading=!1}},async updateRolePermissions(a,r){var s,e;this.loading=!0,this.error=null;try{return{success:!0,data:(await l.updateAccessLevelPermissions(a,r)).data}}catch(t){return this.error=((e=(s=t.response)==null?void 0:s.data)==null?void 0:e.message)||"Gagal update permissions role",{success:!1,error:this.error}}finally{this.loading=!1}},async fetchAllUserRoles(){var a,r;this.loading=!0,this.error=null;try{const s=await l.getAllUserAccess();return this.userRoles=s.data||[],{success:!0,data:this.userRoles}}catch(s){return this.error=((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.message)||"Gagal mengambil data user role",{success:!1,error:this.error}}finally{this.loading=!1}},async fetchAllPegawai(a={}){var r,s;this.loading=!0,this.error=null;try{const t=(await o.getAllPegawai(a)).data;return Array.isArray(t)?this.pegawai=t:t&&Array.isArray(t.data)?this.pegawai=t.data:this.pegawai=[],{success:!0,data:this.pegawai}}catch(e){return this.error=((s=(r=e.response)==null?void 0:r.data)==null?void 0:s.message)||"Gagal mengambil data pegawai",{success:!1,error:this.error}}finally{this.loading=!1}},async assignRoleToPegawai(a,r,s){var e,t;this.loading=!0,this.error=null;try{const i=await o.assignAccessLevelToPegawai(a,r,s);return this.userRoles.find(c=>c.nip===a&&c.id_role===r)||this.userRoles.push({nip:a,id_role:r,user_id:s}),{success:!0,data:i.data}}catch(i){return this.error=((t=(e=i.response)==null?void 0:e.data)==null?void 0:t.message)||"Gagal assign role ke pegawai",{success:!1,error:this.error}}finally{this.loading=!1}},async removeRoleFromPegawai(a,r){var s,e;this.loading=!0,this.error=null;try{return await o.removeAccessLevelFromPegawai(a,r),this.userRoles=this.userRoles.filter(t=>!(t.nip===a&&t.id_role===r)),{success:!0}}catch(t){return this.error=((e=(s=t.response)==null?void 0:s.data)==null?void 0:e.message)||"Gagal hapus role dari pegawai",{success:!1,error:this.error}}finally{this.loading=!1}},async getPegawaiRoles(a){var r,s;this.loading=!0,this.error=null;try{return{success:!0,data:(await o.getPegawaiAccessLevels(a)).data}}catch(e){return this.error=((s=(r=e.response)==null?void 0:r.data)==null?void 0:s.message)||"Gagal mengambil role pegawai",{success:!1,error:this.error}}finally{this.loading=!1}},async searchPegawai(a,r={}){var s,e;this.loading=!0,this.error=null;try{return{success:!0,data:(await o.searchPegawai(a,r)).data||[]}}catch(t){return this.error=((e=(s=t.response)==null?void 0:s.data)==null?void 0:e.message)||"Gagal mencari pegawai",{success:!1,error:this.error}}finally{this.loading=!1}},setSelectedRole(a){this.selectedRole=a},clearRoles(){this.roles=[],this.userRoles=[],this.pegawai=[],this.selectedRole=null},clearError(){this.error=null}}});export{d as u};
