import{r as v,c as w,h as Z,a as i,i as a,b as s,e as N,n as A,t as u,z as L,F as S,f as $,D as m,m as U,o as ss,A as D,G as B}from"./vendor-abe1rO6K.js";import{_ as q,m as T}from"./index-CXPIpl-L.js";import{s as k}from"./notification-DtWby6W5.js";import"./api-B9ygI19o.js";const es={class:"menu-info"},ns={class:"menu-name"},ls={key:0,class:"permissions-grid"},as={class:"permission-label"},os=["checked","onChange"],is={key:1,class:"child-menus"},ts={__name:"MenuPermissionNode",props:{menu:{type:Object,required:!0}},emits:["permission-changed"],setup(h,{emit:M}){const o=h,r=M,p=v(!0),_=w(()=>o.menu.children&&o.menu.children.length>0?p.value?"fas fa-chevron-down":"fas fa-chevron-right":"fas fa-file"),P=[{key:"can_view",label:"View",icon:"fas fa-eye"},{key:"can_create",label:"Create",icon:"fas fa-plus"},{key:"can_update",label:"Update",icon:"fas fa-edit"},{key:"can_delete",label:"Delete",icon:"fas fa-trash"},{key:"can_export",label:"Export",icon:"fas fa-download"},{key:"can_import",label:"Import",icon:"fas fa-upload"}],E=()=>{p.value=!p.value},b=w(()=>P.every(t=>o.menu.permissions[t.key])),C=()=>{const t=!b.value;P.forEach(c=>{o.menu.permissions[c.key]=t}),r("permission-changed",o.menu)},y=(t,c)=>{o.menu.permissions[t]=c,r("permission-changed",o.menu)};return(t,c)=>{const V=Z("MenuPermissionNode",!0);return a(),i("div",{class:A(["menu-node",{"parent-menu":h.menu.children&&h.menu.children.length}])},[s("div",{class:"menu-header",onClick:E},[s("div",es,[s("i",{class:A([_.value,"menu-toggle-icon"])},null,2),s("span",ns,u(h.menu.nama_menu),1)]),s("div",{class:"menu-actions",onClick:c[0]||(c[0]=L(()=>{},["stop"]))},[s("button",{class:A(["btn-select-all",{"all-selected":b.value}]),onClick:C,title:"Toggle All Permissions"},[s("i",{class:A(b.value?"fas fa-check-square":"far fa-square")},null,2),c[2]||(c[2]=s("span",{class:"d-none d-sm-inline ms-1"},"Select All",-1))],2)])]),p.value?(a(),i("div",ls,[(a(),i(S,null,$(P,g=>s("div",{class:"permission-item",key:g.key},[s("label",as,[s("input",{type:"checkbox",checked:h.menu.permissions[g.key],onChange:R=>y(g.key,R.target.checked),class:"form-check-input"},null,40,os),s("i",{class:A([g.icon,"permission-icon"])},null,2),m(" "+u(g.label),1)])])),64))])):N("",!0),p.value&&h.menu.children&&h.menu.children.length>0?(a(),i("div",is,[(a(!0),i(S,null,$(h.menu.children,g=>(a(),U(V,{key:g.id_menu,menu:g,onPermissionChanged:c[1]||(c[1]=R=>t.$emit("permission-changed",R))},null,8,["menu"]))),128))])):N("",!0)],2)}}},rs=q(ts,[["__scopeId","data-v-5d4df75d"]]),ds={class:"role-menu-management"},us={class:"hero-header"},cs={class:"layout-container"},ms={class:"header-flex"},vs={class:"header-actions"},fs={class:"stats-section"},ps={class:"layout-container"},gs={class:"stats-grid-wrapper"},hs={class:"stat-card stat-primary"},bs={class:"stat-content"},ys={class:"stat-card stat-success"},ks={class:"stat-content"},_s={class:"stat-card stat-warning"},Ps={class:"stat-content"},Cs={class:"stat-card stat-info"},Ms={class:"stat-content"},ws={class:"role-selection-section"},Es={class:"layout-container"},Rs={class:"role-selector-card-modern"},xs={class:"card-body-modern"},Ss={class:"selection-grid"},$s={class:"selection-col"},As={class:"select-wrapper"},Ns=["value"],Ts={class:"selection-col"},Vs={class:"action-buttons"},Os=["disabled"],js=["disabled"],Ds=["disabled"],Bs=["disabled"],Gs={key:0,class:"permissions-section"},Is={class:"layout-container"},Js={class:"permissions-container-modern"},Ls={key:0,class:"loading-state"},Us={key:1,class:"error-state"},qs={class:"error-animation"},Ks={key:2,class:"permission-content"},zs={class:"save-bar"},Fs={class:"save-info"},Hs={class:"save-stats"},Qs={key:0,class:"badge bg-modified"},Ws={class:"badge bg-primary"},Xs=["disabled"],Ys={class:"menu-tree-modern"},Zs={class:"modal-container modal-copy"},se={class:"modal-header-gradient"},ee={class:"modal-body"},ne={class:"copy-content"},le={class:"copy-form"},ae={class:"form-group-modern"},oe=["value"],ie={class:"form-group-modern"},te=["value"],re={class:"modal-footer"},de=["disabled"],ue={__name:"RoleMenuManagementView",setup(h){const M=v([]),o=v(""),r=v([]),p=v([]),_=v(!1),P=v(!1),E=v(!1),b=v(""),C=v(!1),y=v(""),t=v(""),c=w(()=>{let l=0;const e=n=>{n.forEach(d=>{d.permissions&&Object.values(d.permissions).forEach(f=>{f&&l++}),d.children&&e(d.children)})};return e(r.value),l}),V=w(()=>{let l=0;const e=n=>{n.forEach(d=>{l++,d.children&&e(d.children)})};return e(r.value),l}),g=w(()=>{const l=(e,n=1)=>{let d=n;return e.forEach(f=>{f.children&&f.children.length>0&&(d=Math.max(d,l(f.children,n+1)))}),d};return l(r.value)}),R=w(()=>G.value>0),G=w(()=>{let l=0;const e=(n,d)=>{n.forEach((f,Y)=>{const x=d[Y];x&&f.permissions&&x.permissions&&Object.keys(f.permissions).forEach(J=>{f.permissions[J]!==x.permissions[J]&&l++}),f.children&&x&&x.children&&e(f.children,x.children)})};return e(r.value,p.value),l}),K=async()=>{try{const l=await T.getRoleMenuSummary();M.value=l.data||[]}catch(l){console.error("Error loading roles:",l),k("Gagal memuat data role","error")}},O=async()=>{if(!o.value){r.value=[],p.value=[];return}try{_.value=!0,b.value="";const l=await T.getRolePermissions(o.value);r.value=l.data.menus||[],p.value=JSON.parse(JSON.stringify(l.data.menus||[]))}catch(l){b.value="Gagal memuat permissions",console.error("Error loading permissions:",l),k(b.value,"error")}finally{_.value=!1}},z=l=>{console.log("Permission changed:",l.nama_menu,l.permissions)},F=async()=>{try{P.value=!0;const l=[];I(r.value,l),await T.updateRolePermissions(o.value,l),p.value=JSON.parse(JSON.stringify(r.value)),k("Permissions berhasil disimpan","success")}catch(l){console.error("Error saving permissions:",l),k("Gagal menyimpan permissions","error")}finally{P.value=!1}},I=(l,e)=>{l.forEach(n=>{e.push({id_menu:n.id_menu,...n.permissions}),n.children&&I(n.children,e)})},H=async()=>{if(!y.value||!t.value){k("Pilih role sumber dan target","error");return}if(y.value===t.value){k("Role sumber dan target tidak boleh sama","error");return}try{E.value=!0,await T.copyRolePermissions(y.value,t.value),k("Permission berhasil disalin","success"),C.value=!1,o.value===t.value&&await O()}catch(l){console.error("Error copying permissions:",l),k("Gagal menyalin permission","error")}finally{E.value=!1}},Q=()=>{j(r.value,!0)},W=()=>{j(r.value,!1)},j=(l,e)=>{l.forEach(n=>{n.children&&(n.expanded=e,j(n.children,e))})},X=()=>{if(!confirm("Apakah Anda yakin ingin mereset semua permissions menjadi false?"))return;const l=e=>{e.forEach(n=>{n.permissions&&Object.keys(n.permissions).forEach(d=>{n.permissions[d]=!1}),n.children&&l(n.children)})};l(r.value),k("Semua permissions telah direset","info")};return ss(()=>{K()}),(l,e)=>(a(),i("div",ds,[s("div",us,[s("div",cs,[s("div",ms,[e[9]||(e[9]=s("div",{class:"header-content"},[s("h1",{class:"hero-title"},[s("i",{class:"fas fa-shield-alt hero-icon"}),m(" Manajemen Role-Menu ")]),s("p",{class:"hero-subtitle"},"Kelola hak akses pengguna dengan sistem permission yang fleksibel dan aman")],-1)),s("div",vs,[s("button",{class:"btn-back-hero",onClick:e[0]||(e[0]=n=>l.$router.back())},[...e[8]||(e[8]=[s("i",{class:"fas fa-arrow-left me-2"},null,-1),m("Kembali ",-1)])])])])])]),s("div",fs,[s("div",ps,[s("div",gs,[s("div",hs,[e[11]||(e[11]=s("div",{class:"stat-icon"},[s("i",{class:"fas fa-users"})],-1)),s("div",bs,[s("h3",null,u(M.value.length),1),e[10]||(e[10]=s("p",null,"Total Roles",-1))])]),s("div",ys,[e[13]||(e[13]=s("div",{class:"stat-icon"},[s("i",{class:"fas fa-check-circle"})],-1)),s("div",ks,[s("h3",null,u(c.value),1),e[12]||(e[12]=s("p",null,"Permissions Enabled",-1))])]),s("div",_s,[e[15]||(e[15]=s("div",{class:"stat-icon"},[s("i",{class:"fas fa-sitemap"})],-1)),s("div",Ps,[s("h3",null,u(V.value),1),e[14]||(e[14]=s("p",null,"Total Menus",-1))])]),s("div",Cs,[e[17]||(e[17]=s("div",{class:"stat-icon"},[s("i",{class:"fas fa-layer-group"})],-1)),s("div",Ms,[s("h3",null,u(g.value),1),e[16]||(e[16]=s("p",null,"Menu Levels",-1))])])])])]),s("div",ws,[s("div",Es,[s("div",Rs,[e[23]||(e[23]=s("div",{class:"card-header-gradient"},[s("h3",null,[s("i",{class:"fas fa-user-tag me-2"}),m("Pilih Role")]),s("p",{class:"mb-0"},"Pilih role yang ingin Anda kelola permissionnya")],-1)),s("div",xs,[s("div",Ss,[s("div",$s,[s("div",As,[D(s("select",{"onUpdate:modelValue":e[1]||(e[1]=n=>o.value=n),class:"modern-select",onChange:O},[e[18]||(e[18]=s("option",{value:""},"ðŸŽ¯ Pilih Role",-1)),(a(!0),i(S,null,$(M.value,n=>(a(),i("option",{key:n.id_role,value:n.id_role}," ðŸ‘¤ "+u(n.nama_role),9,Ns))),128))],544),[[B,o.value]])])]),s("div",Ts,[s("div",Vs,[s("button",{class:"btn-modern btn-expand",onClick:Q,disabled:!o.value||_.value,title:"Expand All Menus"},[...e[19]||(e[19]=[s("i",{class:"fas fa-expand"},null,-1)])],8,Os),s("button",{class:"btn-modern btn-collapse",onClick:W,disabled:!o.value||_.value,title:"Collapse All Menus"},[...e[20]||(e[20]=[s("i",{class:"fas fa-compress"},null,-1)])],8,js),s("button",{class:"btn-modern btn-copy",onClick:e[2]||(e[2]=n=>C.value=!0),disabled:!o.value,title:"Copy Permissions"},[...e[21]||(e[21]=[s("i",{class:"fas fa-copy"},null,-1)])],8,Ds),s("button",{class:"btn-modern btn-reset",onClick:X,disabled:!o.value||_.value,title:"Reset All Permissions"},[...e[22]||(e[22]=[s("i",{class:"fas fa-undo"},null,-1)])],8,Bs)])])])])])])]),o.value?(a(),i("div",Gs,[s("div",Is,[s("div",Js,[_.value?(a(),i("div",Ls,[...e[24]||(e[24]=[s("div",{class:"loading-animation"},[s("div",{class:"loader"}),s("h4",null,"Sedang Memuat..."),s("p",null,"Mengambil data permissions untuk role")],-1)])])):b.value?(a(),i("div",Us,[s("div",qs,[e[26]||(e[26]=s("i",{class:"fas fa-exclamation-triangle"},null,-1)),e[27]||(e[27]=s("h4",null,"Terjadi Kesalahan",-1)),s("p",null,u(b.value),1),s("button",{class:"btn btn-retry",onClick:O},[...e[25]||(e[25]=[s("i",{class:"fas fa-redo me-2"},null,-1),m("Coba Lagi ",-1)])])])])):(a(),i("div",Ks,[s("div",zs,[s("div",Fs,[e[30]||(e[30]=s("h4",null,[s("i",{class:"fas fa-cog me-2"}),m("Pengaturan Permissions")],-1)),s("div",Hs,[R.value?(a(),i("span",Qs,[e[28]||(e[28]=s("i",{class:"fas fa-edit me-1"},null,-1)),m(u(G.value)+" Modified ",1)])):N("",!0),s("span",Ws,[e[29]||(e[29]=s("i",{class:"fas fa-check me-1"},null,-1)),m(u(c.value)+" Enabled ",1)])])]),s("button",{class:"btn-save-primary",onClick:F,disabled:P.value||!R.value},[e[31]||(e[31]=s("i",{class:"fas fa-save me-2"},null,-1)),m(" "+u(P.value?"ðŸ’¾ Menyimpan...":"ðŸ’¾ Simpan Perubahan"),1)],8,Xs)]),s("div",Ys,[(a(!0),i(S,null,$(r.value,n=>(a(),U(rs,{key:n.id_menu,menu:n,onPermissionChanged:z},null,8,["menu"]))),128))])]))])])])):N("",!0),C.value?(a(),i("div",{key:1,class:"modal-backdrop",onClick:e[7]||(e[7]=L(n=>C.value=!1,["self"]))},[s("div",Zs,[s("div",se,[e[33]||(e[33]=s("h3",null,[s("i",{class:"fas fa-copy me-2"}),m("Copy Permissions")],-1)),s("button",{class:"btn-close-modal",onClick:e[3]||(e[3]=n=>C.value=!1)},[...e[32]||(e[32]=[s("i",{class:"fas fa-times"},null,-1)])])]),s("div",ee,[s("div",ne,[e[39]||(e[39]=s("div",{class:"copy-icon"},[s("i",{class:"fas fa-exchange-alt"})],-1)),s("div",le,[s("div",ae,[e[35]||(e[35]=s("label",null,"ðŸ“¤ Role Sumber",-1)),D(s("select",{"onUpdate:modelValue":e[4]||(e[4]=n=>y.value=n),class:"form-control-modern"},[e[34]||(e[34]=s("option",{value:""},"Pilih Role Sumber",-1)),(a(!0),i(S,null,$(M.value,n=>(a(),i("option",{key:"src-"+n.id_role,value:n.id_role},u(n.nama_role),9,oe))),128))],512),[[B,y.value]])]),e[38]||(e[38]=s("div",{class:"arrow-transfer"},[s("i",{class:"fas fa-arrow-down"})],-1)),s("div",ie,[e[37]||(e[37]=s("label",null,"ðŸ“¥ Role Target",-1)),D(s("select",{"onUpdate:modelValue":e[5]||(e[5]=n=>t.value=n),class:"form-control-modern"},[e[36]||(e[36]=s("option",{value:""},"Pilih Role Target",-1)),(a(!0),i(S,null,$(M.value,n=>(a(),i("option",{key:"tgt-"+n.id_role,value:n.id_role},u(n.nama_role),9,te))),128))],512),[[B,t.value]])])]),e[40]||(e[40]=s("div",{class:"alert-copy"},[s("i",{class:"fas fa-info-circle me-2"}),m(" Permission target akan ditimpa dengan permission dari role sumber ")],-1))])]),s("div",re,[s("button",{class:"btn-cancel",onClick:e[6]||(e[6]=n=>C.value=!1)},[...e[41]||(e[41]=[s("i",{class:"fas fa-times me-2"},null,-1),m("Batal ",-1)])]),s("button",{class:"btn-confirm-copy",onClick:H,disabled:!y.value||!t.value||y.value===t.value||E.value},[e[42]||(e[42]=s("i",{class:"fas fa-copy me-2"},null,-1)),m(" "+u(E.value?"ðŸ”„ Menyalin...":"ðŸš€ Salin Permission"),1)],8,de)])])])):N("",!0)]))}},pe=q(ue,[["__scopeId","data-v-8473df69"]]);export{pe as default};
