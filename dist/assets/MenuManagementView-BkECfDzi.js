import{r as d,c as k,w as ne,o as ie,a as n,b as e,D as v,A as _,B as $,G as z,F as j,f as F,e as y,I as h,t as i,n as p,z as V,L as oe,i as o}from"./vendor-abe1rO6K.js";import{_ as ue,a as re}from"./index-CXPIpl-L.js";import{s as x}from"./notification-DtWby6W5.js";import"./api-B9ygI19o.js";const de={class:"menu-management"},ve={class:"card mb-3 flex-shrink-0 filter-card"},me={class:"card-body"},ce={class:"row g-4 align-items-end"},fe={class:"col-12 col-lg-4"},pe={class:"filter-group"},be={class:"input-group modern-input"},ge={class:"col-6 col-lg-2"},ke={class:"filter-group"},_e={class:"select-wrapper"},ye={class:"col-6 col-lg-3"},Me={class:"filter-group"},he={class:"select-wrapper"},xe=["value"],we={class:"col-12 col-lg-4"},Ce={class:"filter-actions"},Ve={class:"card flex-grow-1 d-flex flex-column",style:{"min-height":"0"}},Se={class:"card-body d-flex flex-column",style:{overflow:"hidden"}},Ue={key:0,class:"text-center py-5"},Te={key:1,class:"alert alert-danger"},$e={key:2,class:"text-center py-5"},Ae={key:3,class:"table-responsive flex-grow-1",style:{"overflow-y":"auto"}},Le={class:"table table-hover"},Pe={class:"table-light"},Be={class:"d-flex align-items-center"},De={class:"menu-name"},je={key:0,class:"badge bg-info ms-2"},Fe={class:"menu-icon"},Ne={class:"text-muted"},Ee={class:"text-center"},Ie={class:"btn-group btn-group-sm"},Ge=["onClick"],qe=["onClick"],ze=["onClick"],He={key:4,class:"d-flex justify-content-between align-items-center mt-3 flex-shrink-0"},Ke={class:"text-muted"},Re={class:"pagination mb-0"},Oe=["onClick"],Qe={class:"sidebar-content"},Je={class:"sidebar-header"},We={class:"sidebar-title"},Xe={class:"sidebar-body"},Ye={class:"form-group"},Ze={class:"input-wrapper"},es={key:0,class:"error-message"},ss={class:"form-group"},ls={class:"input-wrapper"},ts={key:0,class:"error-message"},as={class:"form-group"},ns={class:"input-wrapper"},is={class:"form-group"},os={class:"input-wrapper"},us={class:"form-group"},rs={class:"select-wrapper"},ds=["value","disabled"],vs={class:"form-group"},ms={class:"toggle-group"},cs={class:"toggle-label"},fs={class:"sidebar-footer"},ps=["disabled"],bs={key:0,class:"fas fa-save me-2"},gs={key:1,class:"spinner-border spinner-border-sm me-2"},ks={class:"modal-dialog"},_s={class:"modal-content"},ys={class:"modal-header"},Ms={class:"modal-body"},hs={key:0,class:"alert alert-warning"},xs={class:"modal-footer"},ws=["disabled"],Cs={key:0,class:"spinner-border spinner-border-sm me-2"},Vs={__name:"MenuManagementView",setup(Ss){const r=re(),S=d(""),w=d(""),M=d(""),u=d(1),N=d(10),A=d("urutan"),L=d("asc"),P=d(!1),C=d(!1),b=d(!1),B=d(null),a=d({id_menu:null,nama_menu:"",icon:"",route:"",parent_id:null,urutan:1,is_active:!0}),m=d({}),g=d(null),D=k(()=>{let t=[...r.flatMenuList];if(S.value){const s=S.value.toLowerCase();t=t.filter(c=>{var f;return c.nama_menu.toLowerCase().includes(s)||((f=c.route)==null?void 0:f.toLowerCase().includes(s))})}return w.value!==""&&(t=t.filter(s=>s.is_active===w.value)),M.value!==""?t=t.filter(s=>s.parent_id===M.value):M.value===""&&(t=t.filter(s=>s.parent_id===null)),t.sort((s,c)=>{let f=s[A.value],l=c[A.value];return L.value==="asc"?f>l?1:-1:f<l?1:-1}),t}),U=k(()=>Math.ceil(D.value.length/N.value)),E=k(()=>(u.value-1)*N.value),H=k(()=>E.value+N.value),J=k(()=>D.value.slice(E.value,H.value)),W=k(()=>{const t=[];let c=Math.max(1,u.value-Math.floor(2.5)),f=Math.min(U.value,c+5-1);f-c+1<5&&(c=Math.max(1,f-5+1));for(let l=c;l<=f;l++)t.push(l);return t}),K=k(()=>r.flatMenuList.filter(t=>t.parent_id===null)),X=k(()=>b.value?r.flatMenuList.filter(t=>t.id_menu!==a.value.id_menu):K.value),T=async()=>{try{B.value=null,await r.fetchAllMenus()}catch(t){B.value="Gagal memuat data menu",console.error("Error fetching menus:",t)}},I=()=>{clearTimeout(I.timer),I.timer=setTimeout(()=>{u.value=1},300)},R=t=>{A.value===t?L.value=L.value==="asc"?"desc":"asc":(A.value=t,L.value="asc")},Y=()=>{S.value="",w.value="",M.value="",u.value=1},Z=t=>{b.value=!0,a.value={...t},P.value=!0,m.value={}},G=()=>{P.value=!1,b.value=!1,a.value={id_menu:null,nama_menu:"",icon:"",route:"",parent_id:null,urutan:1,is_active:!0},m.value={}},ee=()=>(m.value={},a.value.nama_menu.trim()||(m.value.nama_menu="Nama menu wajib diisi"),(!a.value.urutan||a.value.urutan<1)&&(m.value.urutan="Urutan harus diisi dengan angka minimal 1"),Object.keys(m.value).length===0),O=async()=>{if(ee())try{const t={...a.value};delete t.id_menu,delete t.children,delete t.parent;let s;b.value?s=await r.updateMenu(a.value.id_menu,t):s=await r.createMenu(t),s.success?(x(b.value?"Menu berhasil diperbarui":"Menu berhasil ditambahkan","success"),G(),await T()):x(s.error||"Gagal menyimpan menu","error")}catch(t){x("Terjadi kesalahan saat menyimpan menu","error"),console.error("Error saving menu:",t)}},se=t=>{g.value=t,C.value=!0},le=async()=>{if(g.value)try{const t=await r.deleteMenu(g.value.id_menu);t.success?(x("Menu berhasil dihapus","success"),C.value=!1,g.value=null,await T()):x(t.error||"Gagal menghapus menu","error")}catch(t){x("Terjadi kesalahan saat menghapus menu","error"),console.error("Error deleting menu:",t)}},te=()=>{a.value.is_active=!a.value.is_active},ae=t=>{x("Fitur permissions akan segera hadir","info")};return ne([w,M],()=>{u.value=1}),ie(()=>{T()}),(t,s)=>{var c,f;return o(),n("div",de,[s[62]||(s[62]=e("div",{class:"page-header"},[e("div",null,[e("h1",{class:"page-title"},"ðŸ“‹ Kelola Menu"),e("p",{class:"page-subtitle"},"Manajemen menu dan hak akses sistem")])],-1)),e("div",ve,[e("div",me,[e("div",ce,[e("div",fe,[e("div",pe,[s[18]||(s[18]=e("label",{class:"filter-label"},[e("i",{class:"fas fa-search"}),v(" Cari Menu ")],-1)),e("div",be,[s[17]||(s[17]=e("span",{class:"input-group-text"},[e("i",{class:"fas fa-search"})],-1)),_(e("input",{"onUpdate:modelValue":s[0]||(s[0]=l=>S.value=l),type:"text",class:"form-control",placeholder:"Masukkan nama menu...",onInput:I},null,544),[[$,S.value]])])])]),e("div",ge,[e("div",ke,[s[21]||(s[21]=e("label",{class:"filter-label"},[e("i",{class:"fas fa-toggle-on"}),v(" Status ")],-1)),e("div",_e,[_(e("select",{"onUpdate:modelValue":s[1]||(s[1]=l=>w.value=l),class:"form-select modern-select",onChange:T},[...s[19]||(s[19]=[e("option",{value:""},"Semua",-1),e("option",{value:!0},"Aktif",-1),e("option",{value:!1},"Non-aktif",-1)])],544),[[z,w.value]]),s[20]||(s[20]=e("i",{class:"fas fa-chevron-down select-arrow"},null,-1))])])]),e("div",ye,[e("div",Me,[s[25]||(s[25]=e("label",{class:"filter-label"},[e("i",{class:"fas fa-layer-group"}),v(" Level ")],-1)),e("div",he,[_(e("select",{"onUpdate:modelValue":s[2]||(s[2]=l=>M.value=l),class:"form-select modern-select",onChange:T},[s[22]||(s[22]=e("option",{value:""},"Semua",-1)),s[23]||(s[23]=e("option",{value:""},"Utama",-1)),(o(!0),n(j,null,F(K.value,l=>(o(),n("option",{key:l.id_menu,value:l.id_menu},i(l.nama_menu),9,xe))),128))],544),[[z,M.value]]),s[24]||(s[24]=e("i",{class:"fas fa-chevron-down select-arrow"},null,-1))])])]),e("div",we,[e("div",Ce,[e("button",{class:"btn-reset",onClick:Y},[...s[26]||(s[26]=[e("i",{class:"fas fa-sync-alt"},null,-1),v(" Reset ",-1)])]),e("button",{class:"btn btn-primary",onClick:s[3]||(s[3]=l=>P.value=!0)},[...s[27]||(s[27]=[e("i",{class:"fas fa-plus"},null,-1),v(" Tambah Menu ",-1)])])])])])])]),e("div",Ve,[e("div",Se,[h(r).loading?(o(),n("div",Ue,[...s[28]||(s[28]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),e("p",{class:"mt-2"},"Memuat data menu...",-1)])])):B.value?(o(),n("div",Te,[s[29]||(s[29]=e("i",{class:"fas fa-exclamation-triangle"},null,-1)),v(" "+i(B.value),1)])):h(r).flatMenuList.length===0?(o(),n("div",$e,[...s[30]||(s[30]=[e("i",{class:"fas fa-folder-open fa-3x text-muted mb-3"},null,-1),e("h5",{class:"text-muted"},"Belum ada data menu",-1),e("p",{class:"text-muted"},'Klik tombol "Tambah Menu" untuk membuat menu baru',-1)])])):(o(),n("div",Ae,[e("table",Le,[e("thead",Pe,[e("tr",null,[e("th",{onClick:s[4]||(s[4]=l=>R("urutan")),style:{cursor:"pointer"}},[...s[31]||(s[31]=[v(" Urutan ",-1),e("i",{class:"fas fa-sort"},null,-1)])]),e("th",{onClick:s[5]||(s[5]=l=>R("nama_menu")),style:{cursor:"pointer"}},[...s[32]||(s[32]=[v(" Nama Menu ",-1),e("i",{class:"fas fa-sort"},null,-1)])]),s[33]||(s[33]=e("th",null,"Icon",-1)),s[34]||(s[34]=e("th",null,"Route",-1)),s[35]||(s[35]=e("th",null,"Parent",-1)),s[36]||(s[36]=e("th",null,"Status",-1)),s[37]||(s[37]=e("th",{class:"text-center"},"Aksi",-1))])]),e("tbody",null,[(o(!0),n(j,null,F(J.value,l=>{var q;return o(),n("tr",{key:l.id_menu},[e("td",null,i(l.urutan),1),e("td",null,[e("div",Be,[e("span",De,i(l.nama_menu),1),l.children&&l.children.length>0?(o(),n("span",je,i(l.children.length)+" sub ",1)):y("",!0)])]),e("td",null,[e("span",Fe,i(l.icon),1)]),e("td",null,[e("code",Ne,i(l.route||"-"),1)]),e("td",null,i(((q=l.parent)==null?void 0:q.nama_menu)||"-"),1),e("td",null,[e("span",{class:p(["badge",l.is_active?"bg-success":"bg-danger"])},i(l.is_active?"Aktif":"Tidak Aktif"),3)]),e("td",Ee,[e("div",Ie,[e("button",{class:"btn btn-outline-primary",onClick:Q=>Z(l),title:"Edit"},[...s[38]||(s[38]=[e("i",{class:"fas fa-edit"},null,-1)])],8,Ge),e("button",{class:"btn btn-outline-info",onClick:Q=>ae(),title:"Permissions"},[...s[39]||(s[39]=[e("i",{class:"fas fa-key"},null,-1)])],8,qe),e("button",{class:"btn btn-outline-danger",onClick:Q=>se(l),title:"Hapus"},[...s[40]||(s[40]=[e("i",{class:"fas fa-trash"},null,-1)])],8,ze)])])])}),128))])])])),U.value>1?(o(),n("div",He,[e("div",Ke," Menampilkan "+i(E.value+1)+"-"+i(Math.min(H.value,D.value.length))+" dari "+i(D.value.length)+" menu ",1),e("nav",null,[e("ul",Re,[e("li",{class:p(["page-item",{disabled:u.value===1}])},[e("a",{class:"page-link",href:"#",onClick:s[6]||(s[6]=V(l=>u.value=1,["prevent"]))},"First")],2),e("li",{class:p(["page-item",{disabled:u.value===1}])},[e("a",{class:"page-link",href:"#",onClick:s[7]||(s[7]=V(l=>u.value--,["prevent"]))},"Previous")],2),(o(!0),n(j,null,F(W.value,l=>(o(),n("li",{key:l,class:p(["page-item",{active:u.value===l}])},[e("a",{class:"page-link",href:"#",onClick:V(q=>u.value=l,["prevent"])},i(l),9,Oe)],2))),128)),e("li",{class:p(["page-item",{disabled:u.value===U.value}])},[e("a",{class:"page-link",href:"#",onClick:s[8]||(s[8]=V(l=>u.value++,["prevent"]))},"Next")],2),e("li",{class:p(["page-item",{disabled:u.value===U.value}])},[e("a",{class:"page-link",href:"#",onClick:s[9]||(s[9]=V(l=>u.value=U.value,["prevent"]))},"Last")],2)])])])):y("",!0)])]),e("div",{class:p(["sidebar-form",{active:P.value}])},[e("div",Qe,[e("div",Je,[e("h5",We,i(b.value?"âœï¸ Edit Menu":"âž• Tambah Menu Baru"),1),e("button",{type:"button",class:"btn-sidebar-close",onClick:G},[...s[41]||(s[41]=[e("i",{class:"fas fa-times"},null,-1)])])]),e("div",Xe,[e("form",{onSubmit:V(O,["prevent"])},[e("div",Ye,[s[43]||(s[43]=e("label",{class:"form-label"},"Nama Menu *",-1)),e("div",Ze,[_(e("input",{"onUpdate:modelValue":s[10]||(s[10]=l=>a.value.nama_menu=l),type:"text",class:p(["form-control",{"is-invalid":m.value.nama_menu}]),placeholder:"Masukkan nama menu",required:""},null,2),[[$,a.value.nama_menu]]),s[42]||(s[42]=e("i",{class:"fas fa-tag input-icon"},null,-1))]),m.value.nama_menu?(o(),n("div",es,i(m.value.nama_menu),1)):y("",!0)]),e("div",ss,[s[45]||(s[45]=e("label",{class:"form-label"},"Urutan *",-1)),e("div",ls,[_(e("input",{"onUpdate:modelValue":s[11]||(s[11]=l=>a.value.urutan=l),type:"number",class:p(["form-control",{"is-invalid":m.value.urutan}]),min:"1",required:""},null,2),[[$,a.value.urutan,void 0,{number:!0}]]),s[44]||(s[44]=e("i",{class:"fas fa-sort-numeric-up input-icon"},null,-1))]),m.value.urutan?(o(),n("div",ts,i(m.value.urutan),1)):y("",!0)]),e("div",as,[s[47]||(s[47]=e("label",{class:"form-label"},"Icon",-1)),e("div",ns,[_(e("input",{"onUpdate:modelValue":s[12]||(s[12]=l=>a.value.icon=l),type:"text",class:"form-control",placeholder:"ðŸ“ atau fas fa-home"},null,512),[[$,a.value.icon]]),s[46]||(s[46]=e("i",{class:"fas fa-icons input-icon"},null,-1))]),s[48]||(s[48]=e("div",{class:"form-help"},"Gunakan emoji atau Font Awesome class",-1))]),e("div",is,[s[50]||(s[50]=e("label",{class:"form-label"},"Route",-1)),e("div",os,[_(e("input",{"onUpdate:modelValue":s[13]||(s[13]=l=>a.value.route=l),type:"text",class:"form-control",placeholder:"/dashboard"},null,512),[[$,a.value.route]]),s[49]||(s[49]=e("i",{class:"fas fa-route input-icon"},null,-1))])]),e("div",us,[s[53]||(s[53]=e("label",{class:"form-label"},"Menu Parent",-1)),e("div",rs,[_(e("select",{"onUpdate:modelValue":s[14]||(s[14]=l=>a.value.parent_id=l),class:"form-select"},[s[51]||(s[51]=e("option",{value:""},"Menu Utama",-1)),(o(!0),n(j,null,F(X.value,l=>(o(),n("option",{key:l.id_menu,value:l.id_menu,disabled:b.value&&l.id_menu===a.value.id_menu},i(l.nama_menu),9,ds))),128))],512),[[z,a.value.parent_id]]),s[52]||(s[52]=e("i",{class:"fas fa-sitemap select-icon"},null,-1))])]),e("div",vs,[s[55]||(s[55]=e("label",{class:"form-label"},"Status",-1)),e("div",ms,[e("div",{class:p(["toggle-switch",{active:a.value.is_active}]),onClick:te},[...s[54]||(s[54]=[e("div",{class:"toggle-slider"},null,-1)])],2),e("span",cs,i(a.value.is_active?"Aktif":"Tidak Aktif"),1)])])],32)]),e("div",fs,[e("button",{type:"button",class:"btn btn-secondary",onClick:G},[...s[56]||(s[56]=[e("i",{class:"fas fa-times me-2"},null,-1),v("Batal ",-1)])]),e("button",{type:"button",class:"btn btn-primary",onClick:O,disabled:h(r).loading},[h(r).loading?y("",!0):(o(),n("i",bs)),h(r).loading?(o(),n("span",gs)):y("",!0),v(" "+i(b.value?"Update":"Simpan"),1)],8,ps)])])],2),e("div",{class:p(["modal fade",{show:C.value}]),style:oe({display:C.value?"block":"none"}),tabindex:"-1"},[e("div",ks,[e("div",_s,[e("div",ys,[s[57]||(s[57]=e("h5",{class:"modal-title"},"âš ï¸ Konfirmasi Hapus",-1)),e("button",{type:"button",class:"btn-close",onClick:s[15]||(s[15]=l=>C.value=!1)})]),e("div",Ms,[e("p",null,[s[58]||(s[58]=v("Apakah Anda yakin ingin menghapus menu ",-1)),e("strong",null,i((c=g.value)==null?void 0:c.nama_menu),1),s[59]||(s[59]=v("?",-1))]),(f=g.value)!=null&&f.children&&g.value.children.length>0?(o(),n("div",hs,[s[60]||(s[60]=e("i",{class:"fas fa-exclamation-triangle"},null,-1)),v(" Menu ini memiliki "+i(g.value.children.length)+" sub-menu. Sub-menu juga akan dihapus! ",1)])):y("",!0)]),e("div",xs,[e("button",{type:"button",class:"btn btn-secondary",onClick:s[16]||(s[16]=l=>C.value=!1)},"Batal"),e("button",{type:"button",class:"btn btn-danger",onClick:le,disabled:h(r).loading},[h(r).loading?(o(),n("span",Cs)):y("",!0),s[61]||(s[61]=v(" Hapus ",-1))],8,ws)])])])],6)])}}},Ls=ue(Vs,[["__scopeId","data-v-36bb5696"]]);export{Ls as default};
