import{r as d,c as q,o as re,a,b as e,D as u,I as v,t as n,F as $,f as T,z as de,A as D,e as _,B as V,n as b,L as j,G as O,i as o}from"./vendor-abe1rO6K.js";import{u as ue}from"./role-tX4kyy7r.js";import{_ as ce,u as ve}from"./index-CXPIpl-L.js";import{s as c}from"./notification-DtWby6W5.js";import"./api-B9ygI19o.js";const me={class:"role-management"},be={class:"page-header"},pe={class:"header-content"},fe={class:"header-actions"},_e={key:0,class:"text-center py-5"},ge={key:1,class:"alert alert-danger"},ke={key:2,class:"text-center py-5"},ye={key:3,class:"row g-4 flex-grow-1",style:{"overflow-y":"auto"}},he={class:"card role-card h-100"},we={class:"card-header bg-primary text-white"},xe={class:"d-flex justify-content-between align-items-center"},Re={class:"card-title mb-0"},Ce={class:"btn-group btn-group-sm"},Ue=["onClick"],Me=["onClick"],Pe=["onClick"],Ae={class:"card-body"},$e={class:"card-text"},Te={class:"row text-center"},De={class:"col-6"},je={class:"stat-box"},Ee={class:"text-primary"},Be={class:"col-6"},Se=["onClick"],Ve={class:"text-info"},Ne={class:"mt-3"},Ge={class:"text-muted"},Ie={class:"card-footer bg-light"},Fe={class:"d-flex justify-content-between align-items-center"},Le={class:"text-muted"},He=["onClick"],Ke=["onClick"],ze={class:"modal-dialog"},qe={class:"modal-content"},Oe={class:"modal-header"},Je={class:"modal-title"},Qe={class:"modal-body"},We={class:"mb-3"},Xe={key:0,class:"invalid-feedback"},Ye={class:"mb-3"},Ze={key:0,class:"invalid-feedback"},es={class:"modal-footer"},ss=["disabled"],ts={key:0,class:"spinner-border spinner-border-sm me-2"},ls={class:"modal-dialog"},as={class:"modal-content"},os={class:"modal-header"},ns={class:"modal-body"},is={key:0,class:"alert alert-warning"},rs={class:"modal-footer"},ds=["disabled"],us={key:0,class:"spinner-border spinner-border-sm me-2"},cs={class:"modal-dialog modal-lg"},vs={class:"modal-content"},ms={class:"modal-header"},bs={class:"modal-title"},ps={class:"modal-body"},fs={class:"mb-3"},_s={class:"input-group"},gs={key:0,class:"text-center py-3"},ks={key:1,class:"text-center py-3"},ys={key:2,class:"table-responsive"},hs={class:"table table-sm"},ws={class:"text-center"},xs=["onClick"],Rs={class:"modal-footer"},Cs={class:"modal-dialog modal-lg"},Us={class:"modal-content"},Ms={class:"modal-header"},Ps={class:"modal-body"},As={class:"row g-3"},$s={class:"col-md-6"},Ts=["value"],Ds={key:0,class:"invalid-feedback"},js={class:"col-md-6"},Es=["value"],Bs={key:0,class:"invalid-feedback"},Ss={class:"modal-footer"},Vs=["disabled"],Ns={key:0,class:"spinner-border spinner-border-sm me-2"},Gs={class:"modal-dialog modal-lg"},Is={class:"modal-content"},Fs={class:"modal-header"},Ls={class:"modal-title"},Hs={class:"modal-body"},Ks={key:0,class:"text-center py-4"},zs={key:1,class:"text-center py-3"},qs={key:2,class:"table-responsive"},Os={class:"table table-sm"},Js={class:"text-center"},Qs={class:"modal-footer"},Ws={__name:"RoleManagementView",setup(Xs){const i=ue(),J=ve(),U=d(!1),h=d(!1),w=d(!1),M=d(!1),g=d(!1),x=d(!1),E=d(null),B=d(""),f=d({id_role:null,nama_role:"",deskripsi:""}),p=d({nip:"",id_role:""}),r=d({}),k=d(null),y=d(null),R=d([]),P=d([]),N=l=>i.userRoles.filter(s=>s.id_role===l).length,Q=q(()=>{if(!B.value)return R.value;const l=B.value.toLowerCase();return R.value.filter(s=>s.nama.toLowerCase().includes(l)||s.nip.includes(l))}),W=q(()=>i.pegawai),A=async()=>{try{E.value=null,await i.fetchAllRoles(),await i.fetchAllUserRoles()}catch(l){E.value="Gagal memuat data role",console.error("Error fetching roles:",l)}},G=async()=>{try{await i.fetchAllPegawai()}catch(l){console.error("Error fetching pegawai:",l)}},X=l=>{x.value=!0,f.value={...l},U.value=!0,r.value={}},S=()=>{U.value=!1,x.value=!1,f.value={id_role:null,nama_role:"",deskripsi:""},r.value={}},Y=()=>(r.value={},f.value.nama_role.trim()||(r.value.nama_role="Nama role wajib diisi"),Object.keys(r.value).length===0),I=async()=>{if(Y())try{const l={...f.value};delete l.id_role;let s;x.value?s=await i.updateRole(f.value.id_role,l):s=await i.createRole(l),s.success?(c(x.value?"Role berhasil diperbarui":"Role berhasil ditambahkan","success"),S(),await A()):c(s.error||"Gagal menyimpan role","error")}catch(l){c("Terjadi kesalahan saat menyimpan role","error"),console.error("Error saving role:",l)}},Z=l=>{k.value=l,h.value=!0},ee=async()=>{if(k.value)try{const l=await i.deleteRole(k.value.id_role);l.success?(c("Role berhasil dihapus","success"),h.value=!1,k.value=null,await A()):c(l.error||"Gagal menghapus role","error")}catch(l){c("Terjadi kesalahan saat menghapus role","error"),console.error("Error deleting role:",l)}},F=async l=>{y.value=l;try{const s=i.getUsersInRole(l.id_role);s.length===0&&i.pegawai.length===0&&await G(),R.value=s,w.value=!0}catch(s){c("Gagal memuat data pengguna","error"),console.error("Error fetching role users:",s)}},se=async l=>{y.value=l;try{const s=await i.getRolePermissions(l.id_role);s.success&&s.data?P.value=s.data.map(m=>m.menu).filter(m=>m!=null):P.value=[],M.value=!0}catch(s){c("Gagal memuat data menu","error"),console.error("Error fetching role menus:",s),P.value=[]}},te=async l=>{if(y.value)try{const s=await i.removeRoleFromPegawai(l.nip,y.value.id_role);s.success?(c("User berhasil dihapus dari role","success"),R.value=R.value.filter(m=>m.nip!==l.nip),await A()):c(s.error||"Gagal menghapus user dari role","error")}catch(s){c("Terjadi kesalahan saat menghapus user dari role","error"),console.error("Error removing user from role:",s)}},le=()=>(r.value={},p.value.nip||(r.value.nip="Pegawai wajib dipilih"),p.value.id_role||(r.value.id_role="Role wajib dipilih"),Object.keys(r.value).length===0),ae=async()=>{var l;if(le())try{const s=((l=J.user)==null?void 0:l.id_user)||1,m=await i.assignRoleToPegawai(p.value.nip,p.value.id_role,s);m.success?(c("User berhasil ditambahkan ke role","success"),p.value={nip:"",id_role:""},g.value=!1,await A()):c(m.error||"Gagal menambahkan user ke role","error")}catch(s){c("Terjadi kesalahan saat menambahkan user ke role","error"),console.error("Error assigning user to role:",s)}},oe=()=>{var l;w.value=!1,g.value=!0,p.value.id_role=((l=y.value)==null?void 0:l.id_role)||""},ne=l=>{c("Fitur permissions akan segera hadir","info")},ie=l=>l?new Date(l).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"}):"-";return re(async()=>{await A(),await G()}),(l,s)=>{var m,L,H,K,z;return o(),a("div",me,[e("div",be,[e("div",pe,[s[17]||(s[17]=e("div",{class:"header-text"},[e("h1",{class:"page-title"},"ðŸ‘¥ Kelola Role"),e("p",{class:"page-subtitle"},"Manajemen role dan hak akses pengguna")],-1)),e("div",fe,[e("button",{class:"btn btn-secondary",onClick:s[0]||(s[0]=t=>g.value=!0)},[...s[15]||(s[15]=[e("i",{class:"fas fa-user-plus"},null,-1),u(" Assign User ",-1)])]),e("button",{class:"btn btn-primary",onClick:s[1]||(s[1]=t=>U.value=!0)},[...s[16]||(s[16]=[e("i",{class:"fas fa-plus"},null,-1),u(" Tambah Role ",-1)])])])])]),v(i).loading?(o(),a("div",_e,[...s[18]||(s[18]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),e("p",{class:"mt-2"},"Memuat data role...",-1)])])):E.value?(o(),a("div",ge,[s[19]||(s[19]=e("i",{class:"fas fa-exclamation-triangle"},null,-1)),u(" "+n(E.value),1)])):v(i).roles.length===0?(o(),a("div",ke,[...s[20]||(s[20]=[e("i",{class:"fas fa-users fa-3x text-muted mb-3"},null,-1),e("h5",{class:"text-muted"},"Belum ada data role",-1),e("p",{class:"text-muted"},'Klik tombol "Tambah Role" untuk membuat role baru',-1)])])):(o(),a("div",ye,[(o(!0),a($,null,T(v(i).rolesWithUserCount,t=>(o(),a("div",{key:t.id_role,class:"col-lg-4 col-md-6"},[e("div",he,[e("div",we,[e("div",xe,[e("h5",Re,n(t.nama_role),1),e("div",Ce,[e("button",{class:"btn btn-light btn-sm",onClick:C=>X(t),title:"Edit"},[...s[21]||(s[21]=[e("i",{class:"fas fa-edit"},null,-1)])],8,Ue),e("button",{class:"btn btn-light btn-sm",onClick:C=>F(t),title:"Lihat User"},[...s[22]||(s[22]=[e("i",{class:"fas fa-users"},null,-1)])],8,Me),e("button",{class:"btn btn-danger btn-sm",onClick:C=>Z(t),title:"Hapus"},[...s[23]||(s[23]=[e("i",{class:"fas fa-trash"},null,-1)])],8,Pe)])])]),e("div",Ae,[e("p",$e,n(t.deskripsi||"Tidak ada deskripsi"),1),e("div",Te,[e("div",De,[e("div",je,[e("h4",Ee,n(t.user_count||0),1),s[24]||(s[24]=e("small",{class:"text-muted"},"Pengguna",-1))])]),e("div",Be,[e("div",{class:"stat-box clickable",onClick:C=>se(t),style:{cursor:"pointer"},title:"Klik untuk lihat menu"},[e("h4",Ve,n(t.menu_count||0),1),s[25]||(s[25]=e("small",{class:"text-muted"},"Menu",-1))],8,Se)])]),e("div",Ne,[e("small",Ge," Dibuat: "+n(ie(t.created_at)),1)])]),e("div",Ie,[e("div",Fe,[e("small",Le,"Role #"+n(t.id_role),1),e("div",null,[e("button",{class:"btn btn-outline-primary btn-sm me-2",onClick:C=>ne()},[...s[26]||(s[26]=[e("i",{class:"fas fa-key"},null,-1),u(" Permissions ",-1)])],8,He),e("button",{class:"btn btn-outline-info btn-sm",onClick:C=>F(t)},[...s[27]||(s[27]=[e("i",{class:"fas fa-users"},null,-1),u(" Users ",-1)])],8,Ke)])])])])]))),128))])),e("div",{class:b(["modal fade",{show:U.value}]),style:j({display:U.value?"block":"none"}),tabindex:"-1"},[e("div",ze,[e("div",qe,[e("div",Oe,[e("h5",Je,n(x.value?"âœï¸ Edit Role":"âž• Tambah Role Baru"),1),e("button",{type:"button",class:"btn-close",onClick:S})]),e("div",Qe,[e("form",{onSubmit:de(I,["prevent"])},[e("div",We,[s[28]||(s[28]=e("label",{class:"form-label"},"Nama Role *",-1)),D(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>f.value.nama_role=t),type:"text",class:b(["form-control",{"is-invalid":r.value.nama_role}]),placeholder:"Masukkan nama role",required:""},null,2),[[V,f.value.nama_role]]),r.value.nama_role?(o(),a("div",Xe,n(r.value.nama_role),1)):_("",!0)]),e("div",Ye,[s[29]||(s[29]=e("label",{class:"form-label"},"Deskripsi",-1)),D(e("textarea",{"onUpdate:modelValue":s[3]||(s[3]=t=>f.value.deskripsi=t),class:b(["form-control",{"is-invalid":r.value.deskripsi}]),rows:"3",placeholder:"Masukkan deskripsi role"},null,2),[[V,f.value.deskripsi]]),r.value.deskripsi?(o(),a("div",Ze,n(r.value.deskripsi),1)):_("",!0)])],32)]),e("div",es,[e("button",{type:"button",class:"btn btn-secondary",onClick:S},"Batal"),e("button",{type:"button",class:"btn btn-primary",onClick:I,disabled:v(i).loading},[v(i).loading?(o(),a("span",ts)):_("",!0),u(" "+n(x.value?"Update":"Simpan"),1)],8,ss)])])])],6),e("div",{class:b(["modal fade",{show:h.value}]),style:j({display:h.value?"block":"none"}),tabindex:"-1"},[e("div",ls,[e("div",as,[e("div",os,[s[30]||(s[30]=e("h5",{class:"modal-title"},"âš ï¸ Konfirmasi Hapus",-1)),e("button",{type:"button",class:"btn-close",onClick:s[4]||(s[4]=t=>h.value=!1)})]),e("div",ns,[e("p",null,[s[31]||(s[31]=u("Apakah Anda yakin ingin menghapus role ",-1)),e("strong",null,n((m=k.value)==null?void 0:m.nama_role),1),s[32]||(s[32]=u("?",-1))]),N((L=k.value)==null?void 0:L.id_role)>0?(o(),a("div",is,[s[33]||(s[33]=e("i",{class:"fas fa-exclamation-triangle"},null,-1)),u(" Role ini memiliki "+n(N((H=k.value)==null?void 0:H.id_role))+" pengguna. Pengguna akan kehilangan aksesnya! ",1)])):_("",!0)]),e("div",rs,[e("button",{type:"button",class:"btn btn-secondary",onClick:s[5]||(s[5]=t=>h.value=!1)},"Batal"),e("button",{type:"button",class:"btn btn-danger",onClick:ee,disabled:v(i).loading},[v(i).loading?(o(),a("span",us)):_("",!0),s[34]||(s[34]=u(" Hapus ",-1))],8,ds)])])])],6),e("div",{class:b(["modal fade",{show:w.value}]),style:j({display:w.value?"block":"none"}),tabindex:"-1"},[e("div",cs,[e("div",vs,[e("div",ms,[e("h5",bs," ðŸ‘¥ Pengguna Role: "+n((K=y.value)==null?void 0:K.nama_role),1),e("button",{type:"button",class:"btn-close",onClick:s[6]||(s[6]=t=>w.value=!1)})]),e("div",ps,[e("div",fs,[e("div",_s,[s[36]||(s[36]=e("span",{class:"input-group-text"},[e("i",{class:"fas fa-search"})],-1)),D(e("input",{"onUpdate:modelValue":s[7]||(s[7]=t=>B.value=t),type:"text",class:"form-control",placeholder:"Cari pegawai..."},null,512),[[V,B.value]]),e("button",{class:"btn btn-outline-primary",onClick:oe},[...s[35]||(s[35]=[e("i",{class:"fas fa-plus"},null,-1),u(" Assign User ",-1)])])])]),v(i).loading?(o(),a("div",gs,[...s[37]||(s[37]=[e("div",{class:"spinner-border spinner-border-sm text-primary",role:"status"},null,-1),e("span",{class:"ms-2"},"Memuat...",-1)])])):R.value.length===0?(o(),a("div",ks,[...s[38]||(s[38]=[e("i",{class:"fas fa-users fa-2x text-muted mb-2"},null,-1),e("p",{class:"text-muted"},"Belum ada pengguna dalam role ini",-1)])])):(o(),a("div",ys,[e("table",hs,[s[40]||(s[40]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"NIP"),e("th",null,"Nama"),e("th",null,"Jabatan"),e("th",null,"Departemen"),e("th",{class:"text-center"},"Aksi")])],-1)),e("tbody",null,[(o(!0),a($,null,T(Q.value,t=>(o(),a("tr",{key:t.nip},[e("td",null,n(t.nip),1),e("td",null,n(t.nama),1),e("td",null,n(t.nama_jabatan||"-"),1),e("td",null,n(t.departemen||"-"),1),e("td",ws,[e("button",{class:"btn btn-outline-danger btn-sm",onClick:C=>te(t),title:"Hapus dari role"},[...s[39]||(s[39]=[e("i",{class:"fas fa-trash"},null,-1)])],8,xs)])]))),128))])])]))]),e("div",Rs,[e("button",{type:"button",class:"btn btn-secondary",onClick:s[8]||(s[8]=t=>w.value=!1)},"Tutup")])])])],6),e("div",{class:b(["modal fade",{show:g.value}]),style:j({display:g.value?"block":"none"}),tabindex:"-1"},[e("div",Cs,[e("div",Us,[e("div",Ms,[s[41]||(s[41]=e("h5",{class:"modal-title"},[e("i",{class:"fas fa-user-plus"}),u(" Assign User ke Role ")],-1)),e("button",{type:"button",class:"btn-close",onClick:s[9]||(s[9]=t=>g.value=!1)})]),e("div",Ps,[e("div",As,[e("div",$s,[s[43]||(s[43]=e("label",{class:"form-label"},"Pilih Pegawai *",-1)),D(e("select",{"onUpdate:modelValue":s[10]||(s[10]=t=>p.value.nip=t),class:b(["form-select",{"is-invalid":r.value.nip}])},[s[42]||(s[42]=e("option",{value:""},"-- Pilih Pegawai --",-1)),(o(!0),a($,null,T(W.value,t=>(o(),a("option",{key:t.nip,value:t.nip},n(t.nama)+" ("+n(t.nip)+") ",9,Ts))),128))],2),[[O,p.value.nip]]),r.value.nip?(o(),a("div",Ds,n(r.value.nip),1)):_("",!0)]),e("div",js,[s[45]||(s[45]=e("label",{class:"form-label"},"Pilih Role *",-1)),D(e("select",{"onUpdate:modelValue":s[11]||(s[11]=t=>p.value.id_role=t),class:b(["form-select",{"is-invalid":r.value.id_role}])},[s[44]||(s[44]=e("option",{value:""},"-- Pilih Role --",-1)),(o(!0),a($,null,T(v(i).roles,t=>(o(),a("option",{key:t.id_role,value:t.id_role},n(t.nama_role),9,Es))),128))],2),[[O,p.value.id_role]]),r.value.id_role?(o(),a("div",Bs,n(r.value.id_role),1)):_("",!0)])]),s[46]||(s[46]=e("div",{class:"mt-3"},[e("small",{class:"text-muted"},[e("i",{class:"fas fa-info-circle"}),u(" User akan mendapatkan akses ke semua menu yang ditetapkan untuk role ini. ")])],-1))]),e("div",Ss,[e("button",{type:"button",class:"btn btn-secondary",onClick:s[12]||(s[12]=t=>g.value=!1)},"Batal"),e("button",{type:"button",class:"btn btn-primary",onClick:ae,disabled:v(i).loading},[v(i).loading?(o(),a("span",Ns)):_("",!0),s[47]||(s[47]=u(" Assign User ",-1))],8,Vs)])])])],6),e("div",{class:b(["modal fade",{show:M.value}]),style:j({display:M.value?"block":"none"}),tabindex:"-1"},[e("div",Gs,[e("div",Is,[e("div",Fs,[e("h5",Ls,[s[48]||(s[48]=e("i",{class:"fas fa-list"},null,-1)),u(" Menu untuk Role: "+n((z=y.value)==null?void 0:z.nama_role),1)]),e("button",{type:"button",class:"btn-close",onClick:s[13]||(s[13]=t=>M.value=!1)})]),e("div",Hs,[v(i).loading?(o(),a("div",Ks,[...s[49]||(s[49]=[e("div",{class:"spinner-border spinner-border-sm text-primary",role:"status"},null,-1),e("span",{class:"ms-2"},"Memuat...",-1)])])):P.value.length===0?(o(),a("div",zs,[...s[50]||(s[50]=[e("i",{class:"fas fa-list fa-2x text-muted mb-2"},null,-1),e("p",{class:"text-muted"},"Belum ada menu dalam role ini",-1)])])):(o(),a("div",qs,[e("table",Os,[s[51]||(s[51]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"Nama Menu"),e("th",null,"Route"),e("th",null,"Icon"),e("th",{class:"text-center"},"Status")])],-1)),e("tbody",null,[(o(!0),a($,null,T(P.value,t=>(o(),a("tr",{key:t.id_menu},[e("td",null,n(t.nama_menu),1),e("td",null,[e("code",null,n(t.route||"-"),1)]),e("td",null,[e("i",{class:b(t.icon||"fas fa-circle")},null,2)]),e("td",Js,[e("span",{class:b(["badge",t.is_active?"bg-success":"bg-secondary"])},n(t.is_active?"Aktif":"Non-aktif"),3)])]))),128))])])]))]),e("div",Qs,[e("button",{type:"button",class:"btn btn-secondary",onClick:s[14]||(s[14]=t=>M.value=!1)},"Tutup")])])])],6)])}}},lt=ce(Ws,[["__scopeId","data-v-c39df2b3"]]);export{lt as default};
