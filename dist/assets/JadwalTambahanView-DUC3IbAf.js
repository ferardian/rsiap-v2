import{r as h,c as _,o as dt,w as ct,a as u,b as s,e as L,j as I,A as ht,B as mt,D as w,F as b,f as g,t as o,z as vt,i as r,n as p}from"./vendor-abe1rO6K.js";import{j as O}from"./jadwalTambahanService-D8qiHJJ3.js";import{_ as ft,u as bt}from"./index-CXPIpl-L.js";import{S as U}from"./SearchableSelect-Lnl9dbY0.js";import"./api-B9ygI19o.js";const gt={class:"jadwal-page"},pt={class:"page-header"},yt={class:"controls"},_t={class:"filter-group"},wt={key:0,class:"loading-state"},kt={key:1,class:"table-container"},St={class:"table-wrapper"},Ct={class:"schedule-table"},Dt={class:"day-name"},jt={class:"sticky-col name-col"},Mt={class:"employee-info"},Pt={class:"emp-name"},Tt={class:"emp-dept"},Jt=["onClick"],Vt={class:"stats-cell"},xt={class:"stats-cell"},$t={class:"stats-cell"},Lt={class:"stats-cell font-bold"},Ot={class:"stats-cell"},Et={class:"stats-cell"},Ft={class:"stats-cell"},Nt={key:2,class:"summary-section"},Bt={class:"table-container summary-table-container"},Rt={class:"table-wrapper"},At={class:"schedule-table summary-table"},Ht={class:"sticky-col name-col shift-label"},It={key:3,class:"floating-actions"},Ut={class:"changes-info"},Gt=["disabled"],Kt={key:0,class:"fas fa-spinner fa-spin"},zt={key:1},Yt={class:"modal-content"},qt={class:"modal-body"},Qt={class:"modal-context"},Wt={class:"shift-grid"},Xt=["onClick"],Zt={class:"shift-code"},te={class:"shift-time"},ee={class:"shift-name"},se={__name:"JadwalTambahanView",setup(ae){const G=bt(),E=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"],D=new Date().getFullYear(),K=[D-1,D,D+1],i=h({month:new Date().getMonth()+1,year:D,search:"",department:"all"}),z=()=>{var t,l,e;const a=(e=(l=(t=G.user)==null?void 0:t.data)==null?void 0:l.detail)==null?void 0:e.departemen;a&&(i.value.department=a)},y=h(!1),j=h(!1),M=h([]),F=h([]),P=h(!1),m=h({}),V=h(!1),k=h(null),S=h(null),c=_(()=>new Date(i.value.year,i.value.month,0).getDate()),Y=_(()=>E.map((a,t)=>({id:t+1,name:a}))),q=_(()=>K.map(a=>({id:a,name:a.toString()}))),N=_(()=>M.value),Q=["Pagi","Siang","Malam","Cuti"],W=_(()=>{const a={};return Q.forEach(t=>{a[t]={};for(let l=1;l<=c.value;l++)a[t][l]=0}),N.value.forEach(t=>{for(let l=1;l<=c.value;l++){const e=v(t,l);if(e){let n=null;const d=e.toLowerCase();d.includes("pagi")?n="Pagi":d.includes("siang")?n="Siang":d.includes("malam")?n="Malam":d.includes("cuti")&&(n="Cuti"),n&&a[n][l]++}}}),a}),X=_(()=>Object.keys(m.value).length),Z=(a,t)=>{const l=`${a}_${t}`;return m.value[l]!==void 0},tt=(a,t)=>v(a,t)||"-",T=(a,t)=>{let l=0;for(let e=1;e<=c.value;e++){const n=v(a,e);n&&n.toLowerCase().includes(t.toLowerCase())&&l++}return l},et=a=>{let t=0;for(let l=1;l<=c.value;l++){const e=v(a,l);e&&e!=="-"&&!e.toLowerCase().includes("cuti")&&t++}return t},st=a=>{let t=0;for(let l=1;l<=c.value;l++){const e=v(a,l);(!e||e==="-")&&t++}return t},at={pagi:7,siang:7,malam:10},B=a=>{let t=0;for(let l=1;l<=c.value;l++){const e=v(a,l);if(e){const n=e.toLowerCase();let d=!1;for(const[f,$]of Object.entries(at))if(n.includes(f)){t+=$,d=!0;break}!d&&!n.includes("cuti")&&e!=="-"&&(t+=7)}}return t},R=a=>B(a)-173,lt=a=>R(a)>=0?"text-green-600":"text-red-600",nt=a=>{switch(a){case"Pagi":return"row-blue";case"Siang":return"row-yellow";case"Malam":return"row-blue";case"Cuti":return"row-yellow";default:return""}},J=a=>new Date(i.value.year,i.value.month-1,a).getDay()===0,A=a=>{const t=new Date(i.value.year,i.value.month-1,a);return["Min","Sen","Sel","Rab","Kam","Jum","Sab"][t.getDay()]},C=async()=>{y.value=!0,M.value=[],m.value={},P.value=!1;try{const[a,t]=await Promise.all([O.getSchedule(i.value.month,i.value.year,i.value.department,i.value.search),O.getShifts()]);a.data&&a.data.data&&(M.value=a.data.data),t.data&&t.data.data&&(F.value=t.data.data)}catch(a){console.error("Failed to load schedule",a),alert("Gagal memuat data jadwal tambahan.")}finally{y.value=!1}},ot=()=>{setTimeout(()=>{C()},500)},v=(a,t)=>{const l=`${a.id}_${t}`;if(m.value[l]!==void 0)return m.value[l];if(a.jadwal){const e=`h${t}`;return a.jadwal[e]}return null},it=a=>{if(!a)return"bg-gray-100";const t=a.toLowerCase();return t.includes("pagi")?"shift-pagi":t.includes("siang")?"shift-siang":t.includes("malam")?"shift-malam":t.includes("cuti")?"shift-cuti":t.includes("libur")?"shift-libur":t.includes("midle")?"shift-midle":"shift-default"},ut=(a,t)=>{k.value=a,S.value=t,V.value=!0},x=()=>{V.value=!1,k.value=null,S.value=null},H=a=>{if(k.value&&S.value){const t=`${k.value.id}_${S.value}`;m.value[t]=a,P.value=!0}x()},rt=async()=>{var a,t;if(P.value){j.value=!0;try{const l={};Object.keys(m.value).forEach(d=>{const[f,$]=d.split("_");l[f]||(l[f]={}),l[f][`h${$}`]=m.value[d]});const e=Object.keys(l).map(d=>{const f=l[d];return{id:d,...f}}),n=await O.saveSchedule(i.value.month,i.value.year,e);if(n.status===200)await C();else throw new Error(n.data.message||"Gagal menyimpan")}catch(l){console.error("Save failed",l),alert("Gagal menyimpan jadwal: "+(((t=(a=l.response)==null?void 0:a.data)==null?void 0:t.message)||l.message))}finally{j.value=!1}}};return dt(()=>{z(),C()}),ct([()=>i.value.month,()=>i.value.year],()=>{C()}),(a,t)=>{var l;return r(),u("div",gt,[s("div",pt,[t[5]||(t[5]=s("h2",null,"ðŸ“… Pengajuan Jadwal Tambahan",-1)),s("div",yt,[s("div",_t,[I(U,{modelValue:i.value.month,"onUpdate:modelValue":t[0]||(t[0]=e=>i.value.month=e),options:Y.value,placeholder:"Pilih Bulan",class:"month-select",disabled:y.value},null,8,["modelValue","options","disabled"]),I(U,{modelValue:i.value.year,"onUpdate:modelValue":t[1]||(t[1]=e=>i.value.year=e),options:q.value,placeholder:"Pilih Tahun",class:"year-select",disabled:y.value},null,8,["modelValue","options","disabled"]),ht(s("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>i.value.search=e),type:"text",placeholder:"Cari Pegawai...",class:"form-input search-input",onInput:ot},null,544),[[mt,i.value.search]]),s("button",{onClick:C,class:"btn btn-primary"},[...t[4]||(t[4]=[s("i",{class:"fas fa-sync-alt"},null,-1),w(" Refresh ",-1)])])])])]),y.value?(r(),u("div",wt,[...t[6]||(t[6]=[s("div",{class:"spinner"},null,-1),s("p",null,"Memuat data jadwal tambahan...",-1)])])):(r(),u("div",kt,[s("div",St,[s("table",Ct,[s("thead",null,[s("tr",null,[t[7]||(t[7]=s("th",{class:"sticky-col name-col"},[s("span",{class:"desktop-text"},"Nama Pegawai / Departemen"),s("span",{class:"mobile-text"},"Pegawai")],-1)),(r(!0),u(b,null,g(c.value,e=>(r(),u("th",{key:e,class:p([{sunday:J(e)},"date-col"])},[w(o(e)+" ",1),s("div",Dt,o(A(e)),1)],2))),128)),t[8]||(t[8]=s("th",{class:"stats-header"},"Pagi",-1)),t[9]||(t[9]=s("th",{class:"stats-header"},"Siang",-1)),t[10]||(t[10]=s("th",{class:"stats-header"},"Malam",-1)),t[11]||(t[11]=s("th",{class:"stats-header"},"Total",-1)),t[12]||(t[12]=s("th",{class:"stats-header"},"Libur",-1)),t[13]||(t[13]=s("th",{class:"stats-header"},"Cuti",-1)),t[14]||(t[14]=s("th",{class:"stats-header"},"Jumlah Jam",-1)),t[15]||(t[15]=s("th",{class:"stats-header"},"Kewajiban Jam",-1)),t[16]||(t[16]=s("th",{class:"stats-header"},"Lebih Jam",-1))])]),s("tbody",null,[(r(!0),u(b,null,g(N.value,e=>(r(),u("tr",{key:e.id},[s("td",jt,[s("div",Mt,[s("span",Pt,o(e.nama),1),s("span",Tt,o(e.departemen),1)])]),(r(!0),u(b,null,g(c.value,n=>(r(),u("td",{key:n,class:p(["shift-cell",{sunday:J(n),"has-shift":v(e,n)&&v(e,n)!=="-","pend-change":Z(e.id,n)}]),onClick:d=>ut(e,n)},o(tt(e,n)),11,Jt))),128)),s("td",Vt,o(T(e,"Pagi")),1),s("td",xt,o(T(e,"Siang")),1),s("td",$t,o(T(e,"Malam")),1),s("td",Lt,o(et(e)),1),s("td",Ot,o(st(e)),1),s("td",Et,o(T(e,"Cuti")),1),s("td",Ft,o(B(e))+" Jam",1),t[17]||(t[17]=s("td",{class:"stats-cell font-bold"},"173 Jam",-1)),s("td",{class:p(["stats-cell font-bold",lt(e)])},o(R(e))+" Jam",3)]))),128))])])])])),!y.value&&M.value.length>0?(r(),u("div",Nt,[t[20]||(t[20]=s("h3",null,"Jumlah Shift Per Tanggal",-1)),s("div",Bt,[s("div",Rt,[s("table",At,[s("thead",null,[s("tr",null,[t[19]||(t[19]=s("th",{class:"sticky-col name-col"},"Shift",-1)),(r(!0),u(b,null,g(c.value,e=>(r(),u("th",{key:e,class:p([{sunday:J(e)},"date-col"])},[w(o(e)+" ",1),t[18]||(t[18]=s("br",null,null,-1)),w(" "+o(A(e)),1)],2))),128))])]),s("tbody",null,[(r(!0),u(b,null,g(W.value,(e,n)=>(r(),u("tr",{key:n,class:p(nt(n))},[s("td",Ht,o(n),1),(r(!0),u(b,null,g(c.value,d=>(r(),u("td",{key:d,class:p(["summary-cell",{sunday:J(d)}])},o(e[d]||0),3))),128))],2))),128))])])])])])):L("",!0),P.value?(r(),u("div",It,[s("div",Ut,o(X.value)+" perubahan belum disimpan ",1),s("button",{onClick:rt,class:"btn btn-save",disabled:j.value},[j.value?(r(),u("i",Kt)):(r(),u("span",zt,"ðŸ’¾ Simpan Perubahan"))],8,Gt)])):L("",!0),V.value?(r(),u("div",{key:4,class:"modal-overlay",onClick:vt(x,["self"])},[s("div",Yt,[s("div",{class:"modal-header"},[t[21]||(t[21]=s("h3",null,"Pilih Shift",-1)),s("button",{onClick:x,class:"close-btn"},"Ã—")]),s("div",qt,[s("p",Qt,[s("strong",null,o((l=k.value)==null?void 0:l.nama),1),t[22]||(t[22]=w()),t[23]||(t[23]=s("br",null,null,-1)),w(" Tanggal: "+o(S.value)+" "+o(E[i.value.month-1])+" "+o(i.value.year),1)]),s("div",Wt,[s("button",{class:"shift-btn clear-btn",onClick:t[3]||(t[3]=e=>H(null))}," âŒ Hapus / Kosong "),(r(!0),u(b,null,g(F.value,e=>(r(),u("button",{key:e.shift,class:p(["shift-btn",it(e.shift)]),onClick:n=>H(e.shift)},[s("div",Zt,o(e.shift),1),s("div",te,o(e.jam_masuk)+" - "+o(e.jam_pulang),1),s("div",ee,o(e.nama_shift||"Shift"),1)],10,Xt))),128))])])])])):L("",!0)])}}},re=ft(se,[["__scopeId","data-v-7e320cb3"]]);export{re as default};
