import{r as c,c as m,w as Z,o as pe,a,b as e,D as p,A as y,B as be,G as q,F as h,f as _,I as x,t as i,e as F,n as b,z as T,L as ee,E as J,i as o}from"./vendor-abe1rO6K.js";import{u as ge}from"./role-tX4kyy7r.js";import{_ as he,u as _e}from"./index-CXPIpl-L.js";import{s as k}from"./notification-DtWby6W5.js";import"./api-B9ygI19o.js";const ke={class:"user-management"},ye={class:"page-header"},xe={class:"header-content"},we={class:"header-actions"},Re={class:"card mb-3 flex-shrink-0"},Ce={class:"card-body"},Ue={class:"row g-3"},Ae={class:"col-md-4"},Pe={class:"input-group"},Me={class:"col-md-3"},Ve=["value"],$e={class:"col-md-3"},Se={class:"row mb-3 flex-shrink-0"},Te={class:"col-md-3"},je={class:"card bg-primary text-white"},Be={class:"card-body"},Ne={class:"d-flex justify-content-between"},Ie={class:"card-title"},Fe={class:"col-md-3"},De={class:"card bg-success text-white"},Ee={class:"card-body"},Le={class:"d-flex justify-content-between"},ze={class:"card-title"},Ge={class:"col-md-3"},We={class:"card bg-warning text-white"},qe={class:"card-body"},Je={class:"d-flex justify-content-between"},Ke={class:"card-title"},Oe={class:"col-md-3"},Qe={class:"card bg-info text-white"},He={class:"card-body"},Xe={class:"d-flex justify-content-between"},Ye={class:"card-title"},Ze={class:"card flex-grow-1 d-flex flex-column",style:{"min-height":"0"}},es={class:"card-body d-flex flex-column",style:{overflow:"hidden"}},ss={key:0,class:"text-center py-5"},ls={key:1,class:"alert alert-danger"},ts={key:2,class:"text-center py-5"},as={key:3,class:"table-responsive flex-grow-1",style:{"overflow-y":"auto"}},os={class:"table table-hover"},is={class:"table-light"},ns={class:"d-flex align-items-center"},rs={class:"fw-semibold"},ds={class:"text-muted"},us={key:0,class:"d-flex flex-wrap gap-1"},cs={key:1,class:"badge bg-secondary"},vs={class:"text-center"},ms={class:"btn-group btn-group-sm"},fs=["onClick"],ps=["onClick"],bs={key:4,class:"d-flex justify-content-between align-items-center mt-3 flex-shrink-0"},gs={class:"text-muted"},hs={class:"pagination mb-0"},_s=["onClick"],ks={class:"modal-dialog modal-lg"},ys={class:"modal-content"},xs={class:"modal-header"},ws={class:"modal-title"},Rs={class:"modal-body"},Cs={class:"row"},Us={class:"col-md-6"},As={key:0,class:"text-muted mb-3"},Ps={key:1,class:"mb-3"},Ms=["onClick"],Vs={class:"col-md-6"},$s={key:0,class:"text-muted mb-3"},Ss={key:1},Ts=["id","value"],js=["for"],Bs={class:"text-muted"},Ns={class:"modal-footer"},Is=["disabled"],Fs={key:0,class:"spinner-border spinner-border-sm me-2"},Ds={class:"modal-dialog"},Es={class:"modal-content"},Ls={class:"modal-body"},zs={class:"mb-3"},Gs=["value"],Ws={key:0,class:"invalid-feedback"},qs={class:"mb-3"},Js={class:"border rounded p-3",style:{"max-height":"300px","overflow-y":"auto"}},Ks={class:"form-check mb-2"},Os=["id","value"],Qs=["for"],Hs={class:"text-muted"},Xs={class:"text-muted"},Ys={class:"modal-footer"},Zs=["disabled"],el={key:0,class:"spinner-border spinner-border-sm me-2"},sl={__name:"UserManagementView",setup(ll){const n=ge(),K=_e(),P=c(""),w=c(""),R=c(""),v=c(1),D=c(10),j=c("nama"),B=c("asc"),C=c(!1),N=c(!1),E=c(!1),I=c(null),f=c(null),M=c([]),u=c({role_id:"",users:[]}),V=c(!1),g=c({}),$=m(()=>{let t=[...n.pegawai];if(P.value){const s=P.value.toLowerCase();t=t.filter(r=>r.nama.toLowerCase().includes(s)||r.nip.includes(s))}return w.value&&(t=t.filter(s=>n.userRoles.some(r=>r.nip===s.nip&&r.id_role===w.value))),R.value&&(t=t.filter(s=>R.value==="active"?s.status==="active":s.status!=="active")),t.sort((s,r)=>{let l=s[j.value],d=r[j.value];return B.value==="asc"?l>d?1:-1:l<d?1:-1}),t}),S=m(()=>Math.ceil($.value.length/D.value)),L=m(()=>(v.value-1)*D.value),O=m(()=>L.value+D.value),se=m(()=>$.value.slice(L.value,O.value)),le=m(()=>{const t=[];let r=Math.max(1,v.value-Math.floor(2.5)),l=Math.min(S.value,r+5-1);l-r+1<5&&(r=Math.max(1,l-5+1));for(let d=r;d<=l;d++)t.push(d);return t}),te=m(()=>n.pegawai.length),ae=m(()=>n.pegawai.filter(t=>t.status==="active").length),oe=m(()=>n.pegawai.filter(t=>!n.userRoles.some(s=>s.nip===t.nip)).length),z=m(()=>n.pegawai.filter(t=>!n.userRoles.some(s=>s.nip===t.nip))),U=m(()=>f.value?n.userRoles.filter(t=>t.nip===f.value.nip):[]),Q=m(()=>{if(!f.value)return[];const t=U.value.map(s=>s.id_role);return n.roles.filter(s=>!t.includes(s.id_role))}),A=async()=>{try{E.value=!0,I.value=null,await Promise.all([n.fetchAllPegawai({limit:1e3}),n.fetchAllUserRoles()])}catch(t){I.value="Gagal memuat data user",console.error("Error fetching users:",t)}finally{E.value=!1}},ie=async()=>{try{await n.fetchAllRoles()}catch(t){console.error("Error fetching roles:",t)}},G=()=>{clearTimeout(G.timer),G.timer=setTimeout(()=>{v.value=1},300)},H=t=>{j.value===t?B.value=B.value==="asc"?"desc":"asc":(j.value=t,B.value="asc")},ne=()=>{P.value="",w.value="",R.value="",v.value=1},X=t=>n.userRoles.filter(s=>s.nip===t),Y=t=>{const s=n.roles.find(r=>r.id_role===t);return s?s.nama_role:"Unknown Role"},re=t=>{f.value=t,M.value=U.value.map(s=>s.id_role),C.value=!0},de=async t=>{if(f.value)try{const s=await n.removeRoleFromPegawai(f.value.nip,t);s.success?(k("Role berhasil dihapus dari user","success"),await A()):k(s.error||"Gagal menghapus role dari user","error")}catch(s){k("Terjadi kesalahan saat menghapus role","error"),console.error("Error removing role from user:",s)}},ue=async()=>{var t;if(f.value)try{const s=((t=K.user)==null?void 0:t.id_user)||1,r=[];for(const l of M.value)U.value.some(d=>d.id_role===l)||r.push(n.assignRoleToPegawai(f.value.nip,l,s));for(const l of U.value)M.value.includes(l.id_role)||r.push(n.removeRoleFromPegawai(f.value.nip,l.id_role));await Promise.all(r),k("Role user berhasil diperbarui","success"),C.value=!1,await A()}catch(s){k("Terjadi kesalahan saat memperbarui role user","error"),console.error("Error updating user roles:",s)}},ce=()=>{V.value?u.value.users=z.value.map(t=>t.nip):u.value.users=[]},ve=()=>(g.value={},u.value.role_id||(g.value.role_id="Role wajib dipilih"),u.value.users.length===0&&(g.value.users="Pilih minimal satu user"),Object.keys(g.value).length===0),me=async()=>{var t;if(ve())try{const s=((t=K.user)==null?void 0:t.id_user)||1,r=[];for(const l of u.value.users)r.push(n.assignRoleToPegawai(l,u.value.role_id,s));await Promise.all(r),k(`Berhasil assign role ke ${u.value.users.length} user`,"success"),W(),await A()}catch(s){k("Terjadi kesalahan saat bulk assign role","error"),console.error("Error bulk assigning roles:",s)}},W=()=>{N.value=!1,u.value={role_id:"",users:[]},V.value=!1,g.value={}},fe=t=>{k(`Detail user: ${t.nama}`,"info")};return Z(()=>u.value.users,t=>{V.value=t.length===z.value.length}),Z([w,R],()=>{v.value=1}),pe(async()=>{await Promise.all([ie(),A()])}),(t,s)=>{var r;return o(),a("div",ke,[e("div",ye,[e("div",xe,[s[17]||(s[17]=e("div",{class:"header-text"},[e("h1",{class:"page-title"},"ðŸ‘¤ Kelola User"),e("p",{class:"page-subtitle"},"Manajemen pengguna dan hak akses sistem")],-1)),e("div",we,[e("button",{class:"btn btn-primary",onClick:s[0]||(s[0]=l=>N.value=!0)},[...s[16]||(s[16]=[e("i",{class:"fas fa-users"},null,-1),p(" Bulk Assign Role ",-1)])])])])]),e("div",Re,[e("div",Ce,[e("div",Ue,[e("div",Ae,[s[19]||(s[19]=e("label",{class:"form-label"},"Search User",-1)),e("div",Pe,[s[18]||(s[18]=e("span",{class:"input-group-text"},[e("i",{class:"fas fa-search"})],-1)),y(e("input",{"onUpdate:modelValue":s[1]||(s[1]=l=>P.value=l),type:"text",class:"form-control",placeholder:"Cari nama atau NIP...",onInput:G},null,544),[[be,P.value]])])]),e("div",Me,[s[21]||(s[21]=e("label",{class:"form-label"},"Filter Role",-1)),y(e("select",{"onUpdate:modelValue":s[2]||(s[2]=l=>w.value=l),class:"form-select",onChange:A},[s[20]||(s[20]=e("option",{value:""},"Semua Role",-1)),(o(!0),a(h,null,_(x(n).roles,l=>(o(),a("option",{key:l.id_role,value:l.id_role},i(l.nama_role),9,Ve))),128))],544),[[q,w.value]])]),e("div",$e,[s[23]||(s[23]=e("label",{class:"form-label"},"Filter Status",-1)),y(e("select",{"onUpdate:modelValue":s[3]||(s[3]=l=>R.value=l),class:"form-select",onChange:A},[...s[22]||(s[22]=[e("option",{value:""},"Semua Status",-1),e("option",{value:"active"},"Aktif",-1),e("option",{value:"inactive"},"Tidak Aktif",-1)])],544),[[q,R.value]])]),e("div",{class:"col-md-2 d-flex align-items-end"},[e("button",{class:"btn btn-outline-secondary w-100",onClick:ne},[...s[24]||(s[24]=[e("i",{class:"fas fa-redo"},null,-1),p(" Reset ",-1)])])])])])]),e("div",Se,[e("div",Te,[e("div",je,[e("div",Be,[e("div",Ne,[e("div",null,[e("h4",Ie,i(te.value),1),s[25]||(s[25]=e("p",{class:"card-text"},"Total Users",-1))]),s[26]||(s[26]=e("div",{class:"align-self-center"},[e("i",{class:"fas fa-users fa-2x opacity-75"})],-1))])])])]),e("div",Fe,[e("div",De,[e("div",Ee,[e("div",Le,[e("div",null,[e("h4",ze,i(ae.value),1),s[27]||(s[27]=e("p",{class:"card-text"},"Users Aktif",-1))]),s[28]||(s[28]=e("div",{class:"align-self-center"},[e("i",{class:"fas fa-user-check fa-2x opacity-75"})],-1))])])])]),e("div",Ge,[e("div",We,[e("div",qe,[e("div",Je,[e("div",null,[e("h4",Ke,i(oe.value),1),s[29]||(s[29]=e("p",{class:"card-text"},"Tanpa Role",-1))]),s[30]||(s[30]=e("div",{class:"align-self-center"},[e("i",{class:"fas fa-user-slash fa-2x opacity-75"})],-1))])])])]),e("div",Oe,[e("div",Qe,[e("div",He,[e("div",Xe,[e("div",null,[e("h4",Ye,i(x(n).roles.length),1),s[31]||(s[31]=e("p",{class:"card-text"},"Total Role",-1))]),s[32]||(s[32]=e("div",{class:"align-self-center"},[e("i",{class:"fas fa-shield-alt fa-2x opacity-75"})],-1))])])])])]),e("div",Ze,[e("div",es,[E.value?(o(),a("div",ss,[...s[33]||(s[33]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),e("p",{class:"mt-2"},"Memuat data user...",-1)])])):I.value?(o(),a("div",ls,[s[34]||(s[34]=e("i",{class:"fas fa-exclamation-triangle"},null,-1)),p(" "+i(I.value),1)])):$.value.length===0?(o(),a("div",ts,[...s[35]||(s[35]=[e("i",{class:"fas fa-users fa-3x text-muted mb-3"},null,-1),e("h5",{class:"text-muted"},"Tidak ada data user",-1),e("p",{class:"text-muted"},"Coba ubah filter atau pencarian",-1)])])):(o(),a("div",as,[e("table",os,[e("thead",is,[e("tr",null,[e("th",{onClick:s[4]||(s[4]=l=>H("nama")),style:{cursor:"pointer"}},[...s[36]||(s[36]=[p(" Nama ",-1),e("i",{class:"fas fa-sort"},null,-1)])]),e("th",{onClick:s[5]||(s[5]=l=>H("nip")),style:{cursor:"pointer"}},[...s[37]||(s[37]=[p(" NIP ",-1),e("i",{class:"fas fa-sort"},null,-1)])]),s[38]||(s[38]=e("th",null,"Jabatan",-1)),s[39]||(s[39]=e("th",null,"Role",-1)),s[40]||(s[40]=e("th",null,"Status",-1)),s[41]||(s[41]=e("th",{class:"text-center"},"Aksi",-1))])]),e("tbody",null,[(o(!0),a(h,null,_(se.value,l=>(o(),a("tr",{key:l.nip},[e("td",null,[e("div",ns,[s[42]||(s[42]=e("div",{class:"user-avatar me-3"},[e("i",{class:"fas fa-user-circle fa-2x text-primary"})],-1)),e("div",null,[e("div",rs,i(l.nama),1),e("small",ds,i(l.email||"No email"),1)])])]),e("td",null,[e("code",null,i(l.nip),1)]),e("td",null,i(l.jbtn||"-"),1),e("td",null,[X(l.nip).length>0?(o(),a("div",us,[(o(!0),a(h,null,_(X(l.nip),d=>(o(),a("span",{key:d.id_role,class:"badge bg-primary"},i(Y(d.id_role)),1))),128))])):(o(),a("span",cs,"No Role"))]),e("td",null,[e("span",{class:b(["badge",l.status==="active"?"bg-success":"bg-danger"])},i(l.status==="active"?"Aktif":"Tidak Aktif"),3)]),e("td",vs,[e("div",ms,[e("button",{class:"btn btn-outline-primary",onClick:d=>re(l),title:"Manage Roles"},[...s[43]||(s[43]=[e("i",{class:"fas fa-user-shield"},null,-1)])],8,fs),e("button",{class:"btn btn-outline-info",onClick:d=>fe(l),title:"Detail"},[...s[44]||(s[44]=[e("i",{class:"fas fa-eye"},null,-1)])],8,ps)])])]))),128))])])])),S.value>1?(o(),a("div",bs,[e("div",gs," Menampilkan "+i(L.value+1)+"-"+i(Math.min(O.value,$.value.length))+" dari "+i($.value.length)+" user ",1),e("nav",null,[e("ul",hs,[e("li",{class:b(["page-item",{disabled:v.value===1}])},[e("a",{class:"page-link",href:"#",onClick:s[6]||(s[6]=T(l=>v.value=1,["prevent"]))},"First")],2),e("li",{class:b(["page-item",{disabled:v.value===1}])},[e("a",{class:"page-link",href:"#",onClick:s[7]||(s[7]=T(l=>v.value--,["prevent"]))},"Previous")],2),(o(!0),a(h,null,_(le.value,l=>(o(),a("li",{key:l,class:b(["page-item",{active:v.value===l}])},[e("a",{class:"page-link",href:"#",onClick:T(d=>v.value=l,["prevent"])},i(l),9,_s)],2))),128)),e("li",{class:b(["page-item",{disabled:v.value===S.value}])},[e("a",{class:"page-link",href:"#",onClick:s[8]||(s[8]=T(l=>v.value++,["prevent"]))},"Next")],2),e("li",{class:b(["page-item",{disabled:v.value===S.value}])},[e("a",{class:"page-link",href:"#",onClick:s[9]||(s[9]=T(l=>v.value=S.value,["prevent"]))},"Last")],2)])])])):F("",!0)])]),e("div",{class:b(["modal fade",{show:C.value}]),style:ee({display:C.value?"block":"none"}),tabindex:"-1"},[e("div",ks,[e("div",ys,[e("div",xs,[e("h5",ws,[s[45]||(s[45]=e("i",{class:"fas fa-user-shield"},null,-1)),p(" Manage Roles: "+i((r=f.value)==null?void 0:r.nama),1)]),e("button",{type:"button",class:"btn-close",onClick:s[10]||(s[10]=l=>C.value=!1)})]),e("div",Rs,[e("div",Cs,[e("div",Us,[s[47]||(s[47]=e("h6",null,"Current Roles",-1)),U.value.length===0?(o(),a("div",As," User tidak memiliki role ")):(o(),a("div",Ps,[(o(!0),a(h,null,_(U.value,l=>(o(),a("div",{key:l.id_role,class:"badge bg-primary me-2 mb-2 p-2"},[p(i(Y(l.id_role))+" ",1),e("button",{class:"btn btn-sm btn-light ms-1",onClick:d=>de(l.id_role),title:"Remove role"},[...s[46]||(s[46]=[e("i",{class:"fas fa-times"},null,-1)])],8,Ms)]))),128))]))]),e("div",Vs,[s[49]||(s[49]=e("h6",null,"Available Roles",-1)),Q.value.length===0?(o(),a("div",$s," Semua role sudah ditugaskan ")):(o(),a("div",Ss,[(o(!0),a(h,null,_(Q.value,l=>(o(),a("div",{key:l.id_role,class:"form-check mb-2"},[y(e("input",{id:`role-${l.id_role}`,"onUpdate:modelValue":s[11]||(s[11]=d=>M.value=d),value:l.id_role,class:"form-check-input",type:"checkbox"},null,8,Ts),[[J,M.value]]),e("label",{for:`role-${l.id_role}`,class:"form-check-label"},[e("strong",null,i(l.nama_role),1),s[48]||(s[48]=e("br",null,null,-1)),e("small",Bs,i(l.deskripsi||"No description"),1)],8,js)]))),128))]))])])]),e("div",Ns,[e("button",{type:"button",class:"btn btn-secondary",onClick:s[12]||(s[12]=l=>C.value=!1)},"Tutup"),e("button",{type:"button",class:"btn btn-primary",onClick:ue,disabled:x(n).loading},[x(n).loading?(o(),a("span",Fs)):F("",!0),s[50]||(s[50]=p(" Simpan Perubahan ",-1))],8,Is)])])])],6),e("div",{class:b(["modal fade",{show:N.value}]),style:ee({display:N.value?"block":"none"}),tabindex:"-1"},[e("div",Ds,[e("div",Es,[e("div",{class:"modal-header"},[s[51]||(s[51]=e("h5",{class:"modal-title"},[e("i",{class:"fas fa-users"}),p(" Bulk Assign Role ")],-1)),e("button",{type:"button",class:"btn-close",onClick:W})]),e("div",Ls,[e("div",zs,[s[53]||(s[53]=e("label",{class:"form-label"},"Pilih Role *",-1)),y(e("select",{"onUpdate:modelValue":s[13]||(s[13]=l=>u.value.role_id=l),class:b(["form-select",{"is-invalid":g.value.role_id}])},[s[52]||(s[52]=e("option",{value:""},"-- Pilih Role --",-1)),(o(!0),a(h,null,_(x(n).roles,l=>(o(),a("option",{key:l.id_role,value:l.id_role},i(l.nama_role),9,Gs))),128))],2),[[q,u.value.role_id]]),g.value.role_id?(o(),a("div",Ws,i(g.value.role_id),1)):F("",!0)]),e("div",qs,[s[57]||(s[57]=e("label",{class:"form-label"},"Pilih User *",-1)),e("div",Js,[e("div",Ks,[y(e("input",{id:"selectAll","onUpdate:modelValue":s[14]||(s[14]=l=>V.value=l),class:"form-check-input",type:"checkbox",onChange:ce},null,544),[[J,V.value]]),s[54]||(s[54]=e("label",{class:"form-check-label",for:"selectAll"},[e("strong",null,"Pilih Semua")],-1))]),s[56]||(s[56]=e("hr",null,null,-1)),(o(!0),a(h,null,_(z.value,l=>(o(),a("div",{key:l.nip,class:"form-check mb-2"},[y(e("input",{id:`user-${l.nip}`,"onUpdate:modelValue":s[15]||(s[15]=d=>u.value.users=d),value:l.nip,class:"form-check-input",type:"checkbox"},null,8,Os),[[J,u.value.users]]),e("label",{for:`user-${l.nip}`,class:"form-check-label"},[e("strong",null,i(l.nama),1),s[55]||(s[55]=e("br",null,null,-1)),e("small",Hs,i(l.nip)+" - "+i(l.jbtn||"No jabatan"),1)],8,Qs)]))),128))]),e("small",Xs,i(u.value.users.length)+" user dipilih ",1)])]),e("div",Ys,[e("button",{type:"button",class:"btn btn-secondary",onClick:W},"Batal"),e("button",{type:"button",class:"btn btn-primary",onClick:me,disabled:x(n).loading||u.value.users.length===0},[x(n).loading?(o(),a("span",el)):F("",!0),p(" Assign Role ("+i(u.value.users.length)+" users) ",1)],8,Zs)])])])],6)])}}},rl=he(sl,[["__scopeId","data-v-1420ede1"]]);export{rl as default};
