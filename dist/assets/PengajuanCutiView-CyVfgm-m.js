import{c as x,r as p,y as G,w as O,o as Y,a as u,H as E,b as t,e as S,t as d,j as V,D as B,F as H,f as Q,z as P,A as T,B as A,i as o,L as W,n as $}from"./vendor-abe1rO6K.js";import{d as h,_ as X,u as Z}from"./index-CXPIpl-L.js";import{s as m}from"./notification-DtWby6W5.js";import{S as M}from"./SearchableSelect-Lnl9dbY0.js";import"./api-B9ygI19o.js";const k={getCuti(r,i={}){return h.get(`/pegawai/${r}/cuti`,{params:i})},getCounter(r,i={}){return h.get(`/pegawai/${r}/cuti/counter`,{params:i})},createCuti(r,i){return h.post(`/pegawai/${r}/cuti`,i)},deleteCuti(r,i){return h.delete(`/pegawai/${r}/cuti/${i}`)}},tt={class:"pengajuan-cuti-page"},at={class:"stats-grid"},et={class:"stat-card bg-gradient-to-br from-blue-50 to-white border border-blue-100"},st={class:"stat-info"},nt={class:"stat-card bg-gradient-to-br from-green-50 to-white border border-green-100"},lt={class:"stat-info"},it={class:"content-card"},ut={class:"history-header bg-gray-50 border-b border-gray-100"},ot={class:"flex items-center gap-3"},rt={class:"year-filter-wrapper"},dt={class:"card-body p-0"},ct={class:"table-container"},gt={class:"w-full"},pt={key:0},mt={key:1},bt={key:2},vt={class:"font-medium"},ft={class:"text-right pr-4"},yt=["onClick"],ht={class:"modal-body"},kt={class:"form-group"},_t={class:"grid grid-cols-2 gap-4"},Ct={class:"form-group"},wt={class:"form-group"},jt={key:0,class:"info-box"},xt={class:"form-actions"},St=["disabled"],Bt={__name:"PengajuanCutiView",setup(r){const i=Z(),c=x(()=>{var a,n,b,s;const e=i.user;return((n=(a=e==null?void 0:e.data)==null?void 0:a.detail)==null?void 0:n.nik)||((b=e==null?void 0:e.detail)==null?void 0:b.nik)||((s=e==null?void 0:e.data)==null?void 0:s.id_user)||(e==null?void 0:e.username)||(e==null?void 0:e.nik)||""}),_=p(!1),v=p(!1),C=p([]),w=p(null),j=p(!1),g=p("all"),N=x(()=>{const e=new Date().getFullYear(),a=[];for(let n=0;n<6;n++)a.push(e-n);return a}),F=x(()=>{const e=[{value:"all",label:"Semua"}];return N.value.forEach(a=>{e.push({value:a,label:a.toString()})}),e}),l=G({jenis:"",tanggal_cuti:{start:"",end:""}}),L=[{id:"",name:"Pilih Jenis Cuti"},{id:"Cuti Tahunan",name:"Cuti Tahunan"},{id:"Cuti Bersalin",name:"Cuti Bersalin"},{id:"Cuti Diluar Tanggungan",name:"Cuti Diluar Tanggungan"},{id:"Cuti Besar",name:"Cuti Besar"}];O(g,()=>{f()});const f=async()=>{if(c.value){_.value=!0;try{const e=g.value&&g.value!=="all"?{year:g.value}:{},a=await k.getCuti(c.value,e);C.value=a.data.data;const n=await k.getCounter(c.value,e);w.value=n.data.data}catch(e){console.error("Failed to load cuti data",e),m("Gagal memuat data cuti","error")}finally{_.value=!1}}},q=()=>{l.jenis="",l.tanggal_cuti.start="",l.tanggal_cuti.end="",j.value=!0},y=()=>{j.value=!1},U=async()=>{var e,a;if(!c.value){m("User tidak valid","error");return}v.value=!0;try{const n={jenis:l.jenis,tanggal_cuti:{start:l.tanggal_cuti.start,end:l.tanggal_cuti.end}};l.jenis==="Cuti Bersalin"&&(n.tanggal_selesai=l.tanggal_cuti.end),await k.createCuti(c.value,n),m("Pengajuan cuti berhasil dikirim","success"),y(),f()}catch(n){console.error("Failed to submit cuti",n),m(((a=(e=n.response)==null?void 0:e.data)==null?void 0:a.message)||"Gagal mengajukan cuti","error")}finally{v.value=!1}},K=async e=>{if(confirm("Apakah Anda yakin ingin menghapus pengajuan ini?"))try{await k.deleteCuti(c.value,e),m("Pengajuan berhasil dihapus","success"),f()}catch(a){console.error("Failed to delete cuti",a),m("Gagal menghapus pengajuan","error")}},D=e=>e?new Date(e).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}):"-",R=e=>{switch(Number(e)){case 0:return"Menunggu Persetujuan";case 1:return"Dibatalkan";case 2:return"Disetujui";case 3:return"Ditolak";default:return"Unknown"}},I=e=>{switch(Number(e)){case 0:return"fa-clock";case 1:return"fa-ban";case 2:return"fa-check-circle";case 3:return"fa-times-circle";default:return"fa-question-circle"}},J=e=>{const a="status-badge";switch(Number(e)){case 0:return`${a} status-pending`;case 1:return`${a} status-cancelled`;case 2:return`${a} status-approved`;case 3:return`${a} status-rejected`;default:return`${a} status-unknown`}},z=e=>({});return Y(()=>{f()}),(e,a)=>{var n,b;return o(),u("div",tt,[a[22]||(a[22]=E('<div class="page-header" data-v-2ca484bd><div class="header-content" data-v-2ca484bd><div class="header-text" data-v-2ca484bd><h1 class="page-title" data-v-2ca484bd>ðŸ“… Pengajuan Cuti</h1><p class="page-subtitle" data-v-2ca484bd>Kelola pengajuan cuti pegawai</p></div></div></div>',1)),t("div",at,[t("div",et,[a[6]||(a[6]=t("div",{class:"stat-icon bg-blue-500 text-white shadow-lg shadow-blue-500/30"},[t("i",{class:"fas fa-calendar-day"})],-1)),t("div",st,[t("h3",null,d(((n=w.value)==null?void 0:n.jml1)||0),1),a[5]||(a[5]=t("p",{class:"text-blue-600 font-medium"},"Cuti Semester 1",-1))])]),t("div",nt,[a[8]||(a[8]=t("div",{class:"stat-icon bg-green-500 text-white shadow-lg shadow-green-500/30"},[t("i",{class:"fas fa-calendar-check"})],-1)),t("div",lt,[t("h3",null,d(((b=w.value)==null?void 0:b.jml2)||0),1),a[7]||(a[7]=t("p",{class:"text-green-600 font-medium"},"Cuti Semester 2",-1))])])]),t("div",it,[t("div",ut,[t("div",{class:"header-row-with-button"},[a[10]||(a[10]=t("h3",null,"Riwayat Pengajuan",-1)),t("button",{class:"btn-ajukan-cuti",onClick:q},[...a[9]||(a[9]=[t("i",{class:"fas fa-plus"},null,-1),t("span",null,"Ajukan Cuti",-1)])])]),t("div",ot,[a[11]||(a[11]=t("p",{class:"text-sm text-gray-500"},"Daftar riwayat permohonan cuti Anda",-1)),t("div",rt,[V(M,{modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=s=>g.value=s),options:F.value,placeholder:"Pilih Tahun",labelKey:"label",valueKey:"value"},null,8,["modelValue","options"])])])]),t("div",dt,[t("div",ct,[t("table",gt,[a[15]||(a[15]=t("thead",null,[t("tr",null,[t("th",null,"Tanggal Pengajuan"),t("th",null,"Jenis Cuti"),t("th",null,"Tanggal Cuti"),t("th",null,"Status"),t("th",{class:"text-right"},"Aksi")])],-1)),_.value?(o(),u("tbody",pt,[...a[12]||(a[12]=[t("tr",null,[t("td",{colspan:"5",class:"py-8 text-center text-gray-500"},[t("i",{class:"fas fa-spinner fa-spin mr-2"}),B(" Memuat data... ")])],-1)])])):C.value.length===0?(o(),u("tbody",mt,[...a[13]||(a[13]=[t("tr",null,[t("td",{colspan:"5",class:"py-8 text-center text-gray-500"}," Belum ada riwayat pengajuan cuti. ")],-1)])])):(o(),u("tbody",bt,[(o(!0),u(H,null,Q(C.value,s=>(o(),u("tr",{key:s.id_cuti},[t("td",null,d(D(s.tanggal_pengajuan)),1),t("td",null,[t("span",vt,d(s.jenis),1)]),t("td",null,d(D(s.tanggal_cuti)),1),t("td",null,[t("span",{class:$(J(s.status??s.status_cuti)),style:W(z(s.status??s.status_cuti))},[t("i",{class:$(["fas",I(s.status??s.status_cuti)])},null,2),B(" "+d(R(s.status??s.status_cuti)),1)],6)]),t("td",ft,[(s.status??s.status_cuti)==0?(o(),u("button",{key:0,class:"btn-delete-cuti",onClick:Dt=>K(s.id_cuti)},[...a[14]||(a[14]=[t("i",{class:"fas fa-times-circle"},null,-1),t("span",null,"BATAL",-1)])],8,yt)):S("",!0)])]))),128))]))])])])]),j.value?(o(),u("div",{key:0,class:"modal-overlay",onClick:y},[t("div",{class:"modal-content",onClick:a[4]||(a[4]=P(()=>{},["stop"]))},[t("div",{class:"modal-header"},[a[16]||(a[16]=t("h3",null,"Ajukan Cuti Baru",-1)),t("button",{class:"close-btn",onClick:y},"Ã—")]),t("div",ht,[t("form",{onSubmit:P(U,["prevent"]),class:"space-y-5"},[t("div",kt,[a[17]||(a[17]=t("label",{class:"form-label"}," Jenis Cuti ",-1)),V(M,{modelValue:l.jenis,"onUpdate:modelValue":a[1]||(a[1]=s=>l.jenis=s),options:L,placeholder:"Pilih Jenis Cuti",labelKey:"name",valueKey:"id"},null,8,["modelValue"])]),t("div",_t,[t("div",Ct,[a[18]||(a[18]=t("label",{class:"form-label"}," Tanggal Mulai ",-1)),T(t("input",{type:"date","onUpdate:modelValue":a[2]||(a[2]=s=>l.tanggal_cuti.start=s),class:"form-input",required:""},null,512),[[A,l.tanggal_cuti.start]])]),t("div",wt,[a[19]||(a[19]=t("label",{class:"form-label"}," Tanggal Selesai ",-1)),T(t("input",{type:"date","onUpdate:modelValue":a[3]||(a[3]=s=>l.tanggal_cuti.end=s),class:"form-input",required:""},null,512),[[A,l.tanggal_cuti.end]])])]),l.jenis==="Cuti Bersalin"?(o(),u("div",jt,[...a[20]||(a[20]=[t("div",{class:"flex items-start gap-3"},[t("i",{class:"fas fa-info-circle text-blue-500 mt-0.5"}),t("div",{class:"text-sm text-blue-700"},[t("p",{class:"font-semibold mb-1"},"Info Cuti Bersalin"),t("p",null,"Pastikan tanggal mulai diperkirakan 1.5 bulan sebelum HPL atau sesuai rekomendasi dokter.")])],-1)])])):S("",!0),t("div",xt,[t("button",{type:"button",class:"btn-cancel",onClick:y}," Batal "),t("button",{type:"submit",class:"btn-submit",disabled:v.value},[a[21]||(a[21]=t("i",{class:"fas fa-paper-plane mr-2"},null,-1)),B(" "+d(v.value?"Mengirim...":"Ajukan Sekarang"),1)],8,St)])],32)])])])):S("",!0)])}}},Mt=X(Bt,[["__scopeId","data-v-2ca484bd"]]);export{Mt as default};
