import{d as y,_ as M,u as K}from"./index-CXPIpl-L.js";import{S as U}from"./SearchableSelect-Lnl9dbY0.js";import{s as g}from"./notification-DtWby6W5.js";import{c as f,r as b,w as E,o as B,a as l,H as Y,b as t,j as J,F as C,f as N,D as h,t as u,i as o,n as _,e as O}from"./vendor-abe1rO6K.js";import"./api-B9ygI19o.js";const j={getApprovalList(c,r={}){return y.get(`/pegawai/${c}/cuti/approval`,{params:r})},approveLeave(c,r){return y.put(`/pegawai/${c}/cuti/${r}/approve`)},rejectLeave(c,r,i=null){return y.put(`/pegawai/${c}/cuti/${r}/reject`,{reason:i})}},R={class:"approval-cuti-page"},q={class:"content-card"},z={class:"history-header bg-gray-50 border-b border-gray-100"},H={class:"flex items-center gap-3"},Q={class:"year-filter-wrapper"},W={class:"tabs-container"},X=["onClick"],Z={key:0,class:"tab-count"},ee={class:"card-body p-0"},te={class:"table-container"},ae={key:0,class:"loading-state"},se={key:1,class:"empty-state"},ne={class:"text-gray-500"},le={key:2,class:"w-full"},oe={class:"date-with-icon"},re={class:"flex flex-col"},ue={class:"font-semibold text-gray-900"},ie={class:"nik-text"},ce={class:"font-medium text-gray-700"},de={class:"date-with-icon"},pe={key:0,class:"flex justify-center gap-2"},ve=["onClick"],ge=["onClick"],fe={key:1,class:"text-center text-gray-400 text-sm"},he={__name:"ApprovalCutiView",setup(c){const r=K(),i=f(()=>{var s,e,a,n,x,S;return((a=(e=(s=r.user)==null?void 0:s.data)==null?void 0:e.detail)==null?void 0:a.nik)||((x=(n=r.user)==null?void 0:n.detail)==null?void 0:x.nik)||((S=r.user)==null?void 0:S.nik)}),k=b(!1),d=b([]),p=b("all"),v=b("pending"),D=f(()=>[{value:"pending",label:"Menunggu",icon:"fa-clock",count:d.value.filter(s=>(s.status??s.status_cuti)=="0").length},{value:"approved",label:"Disetujui",icon:"fa-check-circle",count:d.value.filter(s=>(s.status??s.status_cuti)=="2").length},{value:"rejected",label:"Ditolak",icon:"fa-times-circle",count:d.value.filter(s=>(s.status??s.status_cuti)=="3").length}]),w=f(()=>{const e={pending:"0",approved:"2",rejected:"3"}[v.value];return d.value.filter(a=>(a.status??a.status_cuti)==e)}),L=f(()=>{const s=new Date().getFullYear(),e=[];for(let a=0;a<6;a++)e.push(s-a);return e}),T=f(()=>{const s=[{value:"all",label:"Semua"}];return L.value.forEach(e=>{s.push({value:e,label:e.toString()})}),s});E(p,()=>{m()});const m=async()=>{if(console.log("loadData called, NIK:",i.value),!i.value){console.error("NIK is not available");return}k.value=!0;try{const s=p.value&&p.value!=="all"?{year:p.value}:{};console.log("Calling API with params:",s);const e=await j.getApprovalList(i.value,s);console.log("API Response:",e.data),d.value=e.data.data,console.log("cutiList updated:",d.value)}catch(s){console.error("Failed to load approval list",s),console.error("Error response:",s.response),g("Gagal memuat data approval","error")}finally{k.value=!1}},$=async s=>{var e,a;if(confirm("Apakah Anda yakin ingin menyetujui pengajuan cuti ini?"))try{await j.approveLeave(i.value,s),g("Pengajuan cuti berhasil disetujui","success"),m()}catch(n){console.error("Failed to approve leave",n),g(((a=(e=n.response)==null?void 0:e.data)==null?void 0:a.message)||"Gagal menyetujui cuti","error")}},I=async s=>{var e,a;if(confirm("Apakah Anda yakin ingin menolak pengajuan cuti ini?"))try{await j.rejectLeave(i.value,s),g("Pengajuan cuti berhasil ditolak","success"),m()}catch(n){console.error("Failed to reject leave",n),g(((a=(e=n.response)==null?void 0:e.data)==null?void 0:a.message)||"Gagal menolak cuti","error")}},A=s=>s?new Date(s).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}):"-",V=()=>({pending:"yang menunggu persetujuan",approved:"yang sudah disetujui",rejected:"yang ditolak"})[v.value]||"",P=s=>{switch(Number(s)){case 0:return"Menunggu Persetujuan";case 1:return"Dibatalkan";case 2:return"Disetujui";case 3:return"Ditolak";default:return"Unknown"}},G=s=>{switch(Number(s)){case 0:return"fa-clock";case 1:return"fa-ban";case 2:return"fa-check-circle";case 3:return"fa-times-circle";default:return"fa-question-circle"}},F=s=>{const e="status-badge";switch(Number(s)){case 0:return`${e} status-pending`;case 1:return`${e} status-cancelled`;case 2:return`${e} status-approved`;case 3:return`${e} status-rejected`;default:return`${e} status-unknown`}};return B(()=>{m()}),(s,e)=>(o(),l("div",R,[e[10]||(e[10]=Y('<div class="page-header" data-v-009b299b><div class="header-content" data-v-009b299b><div class="header-text" data-v-009b299b><h1 class="page-title" data-v-009b299b>âœ… Approval Cuti</h1><p class="page-subtitle" data-v-009b299b>Setujui atau tolak pengajuan cuti pegawai</p></div></div></div>',1)),t("div",q,[t("div",z,[e[2]||(e[2]=t("div",{class:"header-row-with-button"},[t("h3",null,"Daftar Pengajuan Cuti")],-1)),t("div",H,[e[1]||(e[1]=t("p",{class:"text-sm text-gray-500"},"Pengajuan cuti yang menunggu persetujuan Anda",-1)),t("div",Q,[J(U,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=a=>p.value=a),options:T.value,placeholder:"Pilih Tahun",labelKey:"label",valueKey:"value"},null,8,["modelValue","options"])])])]),t("div",W,[(o(!0),l(C,null,N(D.value,a=>(o(),l("button",{key:a.value,onClick:n=>v.value=a.value,class:_(["tab-button",{active:v.value===a.value}])},[t("i",{class:_(["fas",a.icon])},null,2),h(" "+u(a.label)+" ",1),a.count!==void 0?(o(),l("span",Z,u(a.count),1)):O("",!0)],10,X))),128))]),t("div",ee,[t("div",te,[k.value?(o(),l("div",ae,[...e[3]||(e[3]=[t("i",{class:"fas fa-spinner fa-spin mr-2"},null,-1),h(" Memuat data... ",-1)])])):w.value.length===0?(o(),l("div",se,[e[4]||(e[4]=t("i",{class:"fas fa-inbox text-4xl text-gray-300 mb-3"},null,-1)),t("p",ne,"Tidak ada pengajuan cuti "+u(V())+".",1)])):(o(),l("table",le,[e[9]||(e[9]=t("thead",null,[t("tr",null,[t("th",null,"TANGGAL PENGAJUAN"),t("th",null,"NIK & NAMA"),t("th",null,"JENIS CUTI"),t("th",null,"TANGGAL CUTI"),t("th",null,"STATUS"),t("th",{class:"text-center"},"AKSI")])],-1)),t("tbody",null,[(o(!0),l(C,null,N(w.value,a=>(o(),l("tr",{key:a.id_cuti},[t("td",null,[t("div",oe,[e[5]||(e[5]=t("i",{class:"fas fa-calendar"},null,-1)),t("span",null,u(A(a.tanggal_pengajuan)),1)])]),t("td",null,[t("div",re,[t("span",ue,u(a.nama),1),t("span",ie,u(a.nik),1)])]),t("td",null,[t("span",ce,u(a.jenis),1)]),t("td",null,[t("div",de,[e[6]||(e[6]=t("i",{class:"fas fa-clock"},null,-1)),t("span",null,u(A(a.tanggal_cuti)),1)])]),t("td",null,[t("span",{class:_(F(a.status??a.status_cuti))},[t("i",{class:_(["fas",G(a.status??a.status_cuti)])},null,2),h(" "+u(P(a.status??a.status_cuti)),1)],2)]),t("td",null,[v.value==="pending"?(o(),l("div",pe,[t("button",{onClick:n=>$(a.id_cuti),class:"btn-approve",title:"Setujui"},[...e[7]||(e[7]=[t("i",{class:"fas fa-check"},null,-1),h(" Setujui ",-1)])],8,ve),t("button",{onClick:n=>I(a.id_cuti),class:"btn-reject",title:"Tolak"},[...e[8]||(e[8]=[t("i",{class:"fas fa-times"},null,-1),h(" Tolak ",-1)])],8,ge)])):(o(),l("div",fe," - "))])]))),128))])]))])])])]))}},je=M(he,[["__scopeId","data-v-009b299b"]]);export{je as default};
