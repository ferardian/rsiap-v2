import{r as c,c as p,o as ss,l as as,a as d,e as T,b as a,H as es,D as y,n as R,t as n,j as N,F as U,f as V,z as ts,K as ls,i as r}from"./vendor-abe1rO6K.js";import{d as k,_ as is}from"./index-CXPIpl-L.js";import{s as D}from"./notification-DtWby6W5.js";import{S as E}from"./SearchableSelect-Lnl9dbY0.js";import"./api-B9ygI19o.js";const O={async getAllBeds(u={}){return(await k.get("/bed-availability",{params:u})).data},async getSummary(u={}){return(await k.get("/bed-availability/summary",{params:u})).data},async getWards(){return(await k.get("/bed-availability/wards")).data},async getClasses(){return(await k.get("/bed-availability/classes")).data},async getBedsByWard(u){return(await k.get(`/bed-availability/ward/${u}`)).data}},ns={class:"bed-availability-page"},os={key:0,class:"auto-refresh-indicator"},ds={class:"page-header"},rs={class:"header-content"},cs={class:"header-actions"},us={class:"summary-section"},vs={class:"summary-grid"},ps={class:"summary-card total"},ms={class:"card-content"},fs={class:"summary-card available"},bs={class:"card-content"},gs={class:"summary-card occupied"},ys={class:"card-content"},_s={class:"summary-card cleaning"},ks={class:"card-content"},hs={class:"filter-section"},As={class:"filter-group"},Ks={class:"filter-group"},Is={class:"filter-group"},ws={key:1,class:"loading-state"},Bs={key:2,class:"bed-grid-section"},Ss={class:"ward-title"},Cs={class:"category-total-badge"},Ts={class:"class-title"},Ns={class:"class-total-badge"},Us={class:"availability-cards"},Vs=["onClick"],Ds={class:"card-header-info"},Es={class:"bangsal-name"},Os={class:"class-badge"},Ps={class:"availability-stats"},xs={class:"stat-icon"},Ls={class:"stat-content"},Rs={class:"stat-number"},Ms={class:"stat-label"},Gs={key:3,class:"empty-state"},js={class:"modal-header"},Ws={key:0,class:"modal-body"},$s={class:"detail-row"},Fs={class:"detail-value"},Hs={class:"detail-row"},zs={class:"detail-value"},Ys={class:"detail-row"},qs={class:"detail-value"},Js={class:"detail-row"},Qs={class:"detail-value"},Xs={class:"status-badge available"},Zs={class:"detail-row"},sa={class:"detail-value"},aa={class:"status-badge occupied"},ea={class:"detail-row"},ta={class:"detail-value"},la={__name:"BedAvailabilityView",setup(u){const m=c(!1),w=c(!1),f=c([]),M=c([]),h=c([]),A=c(""),K=c(""),P=c(""),I=c(!1),v=c(null),B=c(null),G=[{id:"",name:"Semua Kategori"},{id:"ANAK",name:"Anak"},{id:"KANDUNGAN",name:"Kandungan"},{id:"KAMAR BERSALIN",name:"Kamar Bersalin"},{id:"ICU",name:"ICU"},{id:"ISOLASI",name:"Isolasi"}],j=[{id:"",name:"Semua Status"},{id:"KOSONG",name:"Tersedia"},{id:"ISI",name:"Terisi"},{id:"DIBERSIHKAN",name:"Dibersihkan"},{id:"DIBOOKING",name:"Dibooking"}],W=p(()=>{const e=[{id:"",name:"Semua Kelas"}];return h.value&&h.value.length&&h.value.forEach(s=>e.push({id:s,name:s})),e}),S=e=>{const s=(e.kd_kamar||"").toUpperCase(),t=(e.nm_bangsal||e.kd_bangsal).replace(/\s*\d+\s*$/,"").trim();return s.includes("ISOLASI")||s.includes("ISO")?"ISOLASI":s.includes("ICU")||s.includes("ICCU")||s.includes("PICU")||s.includes("NICU")?"ICU":s.includes("VK")||s.includes("BERSALIN")?"KAMAR BERSALIN":s.includes("ANAK")||s.includes("BAYI")||s.includes("PERINA")?"ANAK":s.includes("KANDUNGAN")||s.includes("KEBIDANAN")?"KANDUNGAN":t};p(()=>{const e=["ANAK","KANDUNGAN","KAMAR BERSALIN","ICU","ISOLASI"],s={};return e.forEach(t=>{s[t]={name:t,capacity:0,occupied:0,available:0}}),f.value.forEach(t=>{const o=S(t);s[o]&&(s[o].capacity+=t.kapasitas,s[o].occupied+=t.terisi,s[o].available+=t.tersedia)}),Object.values(s)});const $=p(()=>{let e=f.value;return A.value&&(e=e.filter(s=>S(s)===A.value)),e}),F=p(()=>{const e={};$.value.forEach(l=>{const i=S(l),b=l.kelas||"Tidak ada kelas";e[i]||(e[i]={}),e[i][b]||(e[i][b]=[]),e[i][b].push(l)});const s={VIP:10,VVIP:5,"Kelas 1":20,"Kelas 2":30,"Kelas 3":40,Utama:50},t=l=>s[l]?s[l]:l.includes("VIP")?10:l.includes("Kelas 1")?20:l.includes("Kelas 2")?30:l.includes("Kelas 3")?40:l.includes("Utama")?50:100,o={};return Object.keys(e).forEach(l=>{const i=e[l],b=Object.keys(i).map(g=>({kelas:g,beds:i[g],weight:t(g)}));b.sort((g,C)=>g.weight!==C.weight?g.weight-C.weight:g.kelas.localeCompare(C.kelas)),o[l]=b}),o}),H=p(()=>f.value.reduce((e,s)=>e+s.kapasitas,0)),z=p(()=>f.value.reduce((e,s)=>e+s.tersedia,0)),Y=p(()=>f.value.reduce((e,s)=>e+s.terisi,0)),q=p(()=>0),_=async(e=!1)=>{try{const s=e?window.scrollY:0;e?w.value=!0:m.value=!0;const t={};K.value&&(t.kelas=K.value);const o=await O.getAllBeds(t);o.success?(f.value=o.data,e&&s>0&&(await ls(),requestAnimationFrame(()=>{window.scrollTo({top:s,behavior:"instant"})}))):D("Gagal memuat data tempat tidur","error")}catch(s){console.error("Error loading beds:",s),D("Terjadi kesalahan saat memuat data","error")}finally{e?setTimeout(()=>{w.value=!1},1e3):m.value=!1}},x=async()=>{try{const e=await O.getWards();e.success&&(M.value=e.data)}catch(e){console.error("Error loading wards:",e)}},L=async()=>{try{const e=await O.getClasses();e.success&&(h.value=e.data)}catch(e){console.error("Error loading classes:",e)}},J=async()=>{await Promise.all([_(),x(),L()]),D("Data berhasil diperbarui","success")},Q=e=>{v.value=e,I.value=!0},X=e=>!e||!Array.isArray(e)?0:e.reduce((s,t)=>s+t.beds.reduce((o,l)=>o+l.kapasitas,0),0),Z=e=>!e||!e.beds?0:e.beds.reduce((s,t)=>s+t.kapasitas,0);return ss(async()=>{await Promise.all([_(),x(),L()]),B.value=setInterval(()=>{_(!0)},3e4)}),as(()=>{B.value&&clearInterval(B.value)}),(e,s)=>(r(),d("div",ns,[w.value?(r(),d("div",os,[...s[6]||(s[6]=[a("div",{class:"refresh-spinner"},null,-1),a("span",null,"Memperbarui data...",-1)])])):T("",!0),a("div",ds,[a("div",rs,[s[8]||(s[8]=a("div",{class:"header-text"},[a("h1",{class:"page-title"},"ðŸ›ï¸ Ketersediaan Tempat Tidur"),a("p",{class:"page-subtitle"},"Monitor ketersediaan tempat tidur secara real-time")],-1)),a("div",cs,[a("button",{class:"btn btn-secondary",onClick:J},[a("i",{class:R(["fas fa-sync-alt",{"fa-spin":m.value}])},null,2),s[7]||(s[7]=y(" Refresh ",-1))])])])]),a("div",us,[a("div",vs,[a("div",ps,[s[10]||(s[10]=a("div",{class:"card-icon"},"ðŸ¥",-1)),a("div",ms,[a("h3",null,n(H.value),1),s[9]||(s[9]=a("p",null,"Total Tempat Tidur",-1))])]),a("div",fs,[s[12]||(s[12]=a("div",{class:"card-icon"},"âœ…",-1)),a("div",bs,[a("h3",null,n(z.value),1),s[11]||(s[11]=a("p",null,"Tersedia",-1))])]),a("div",gs,[s[14]||(s[14]=a("div",{class:"card-icon"},"ðŸ”´",-1)),a("div",ys,[a("h3",null,n(Y.value),1),s[13]||(s[13]=a("p",null,"Terisi",-1))])]),a("div",_s,[s[16]||(s[16]=a("div",{class:"card-icon"},"ðŸ§¹",-1)),a("div",ks,[a("h3",null,n(q.value),1),s[15]||(s[15]=a("p",null,"Dibersihkan",-1))])])])]),a("div",hs,[a("div",As,[s[17]||(s[17]=a("label",{class:"filter-label"},[a("i",{class:"fas fa-hospital"}),y(" Pilih Bangsal ")],-1)),N(E,{modelValue:A.value,"onUpdate:modelValue":s[0]||(s[0]=t=>A.value=t),options:G,placeholder:"Semua Kategori",labelKey:"name",valueKey:"id"},null,8,["modelValue"])]),a("div",Ks,[s[18]||(s[18]=a("label",{class:"filter-label"},[a("i",{class:"fas fa-star"}),y(" Pilih Kelas ")],-1)),N(E,{modelValue:K.value,"onUpdate:modelValue":s[1]||(s[1]=t=>K.value=t),options:W.value,placeholder:"Semua Kelas",labelKey:"name",valueKey:"id",onChange:_},null,8,["modelValue","options"])]),a("div",Is,[s[19]||(s[19]=a("label",{class:"filter-label"},[a("i",{class:"fas fa-filter"}),y(" Status ")],-1)),N(E,{modelValue:P.value,"onUpdate:modelValue":s[2]||(s[2]=t=>P.value=t),options:j,placeholder:"Semua Status",labelKey:"name",valueKey:"id",onChange:_},null,8,["modelValue"])])]),s[29]||(s[29]=es('<div class="legend-section" data-v-faa83b26><div class="legend-item" data-v-faa83b26><span class="legend-box available" data-v-faa83b26></span><span data-v-faa83b26>Tersedia</span></div><div class="legend-item" data-v-faa83b26><span class="legend-box occupied" data-v-faa83b26></span><span data-v-faa83b26>Terisi</span></div><div class="legend-item" data-v-faa83b26><span class="legend-box cleaning" data-v-faa83b26></span><span data-v-faa83b26>Dibersihkan</span></div><div class="legend-item" data-v-faa83b26><span class="legend-box booked" data-v-faa83b26></span><span data-v-faa83b26>Dibooking</span></div></div>',1)),m.value?(r(),d("div",ws,[...s[20]||(s[20]=[a("div",{class:"spinner"},null,-1),a("p",null,"Memuat data...",-1)])])):f.value.length>0?(r(),d("div",Bs,[(r(!0),d(U,null,V(F.value,(t,o)=>(r(),d("div",{key:o,class:"ward-section"},[a("h3",Ss,[y(n(o)+" ",1),a("span",Cs,n(X(t))+" Bed",1)]),(r(!0),d(U,null,V(t,l=>(r(),d("div",{key:l.kelas,class:"class-section"},[a("h4",Ts,[y(n(l.kelas)+" ",1),a("span",Ns,n(Z(l))+" Bed",1)]),a("div",Us,[(r(!0),d(U,null,V(l.beds,i=>(r(),d("div",{key:i.kd_bangsal+i.kd_kamar,class:"availability-card",onClick:b=>Q(i)},[a("div",Ds,[a("div",Es,n(i.nm_bangsal),1),a("div",Os,n(i.kelas),1)]),a("div",Ps,[a("div",{class:R(["stat-item",i.tersedia>0?"available":"occupied"])},[a("div",xs,n(i.tersedia>0?"âœ“":"âœ•"),1),a("div",Ls,[a("div",Rs,n(i.tersedia>0?i.tersedia:"PENUH"),1),a("div",Ms,n(i.tersedia>0?"Tersedia":"Terisi"),1)])],2)])],8,Vs))),128))])]))),128))]))),128))])):(r(),d("div",Gs,[...s[21]||(s[21]=[a("i",{class:"fas fa-bed fa-3x"},null,-1),a("p",null,"Tidak ada data tempat tidur",-1)])])),I.value?(r(),d("div",{key:4,class:"modal-overlay",onClick:s[5]||(s[5]=t=>I.value=!1)},[a("div",{class:"modal-content",onClick:s[4]||(s[4]=ts(()=>{},["stop"]))},[a("div",js,[s[22]||(s[22]=a("h3",null,"Detail Tempat Tidur",-1)),a("button",{class:"close-btn",onClick:s[3]||(s[3]=t=>I.value=!1)},"Ã—")]),v.value?(r(),d("div",Ws,[a("div",$s,[s[23]||(s[23]=a("span",{class:"detail-label"},"Bangsal:",-1)),a("span",Fs,n(v.value.nm_bangsal),1)]),a("div",Hs,[s[24]||(s[24]=a("span",{class:"detail-label"},"Kelas:",-1)),a("span",zs,n(v.value.kelas),1)]),a("div",Ys,[s[25]||(s[25]=a("span",{class:"detail-label"},"Total Kapasitas:",-1)),a("span",qs,n(v.value.kapasitas)+" tempat tidur",1)]),a("div",Js,[s[26]||(s[26]=a("span",{class:"detail-label"},"Tersedia:",-1)),a("span",Qs,[a("span",Xs,n(v.value.tersedia)+" tempat tidur",1)])]),a("div",Zs,[s[27]||(s[27]=a("span",{class:"detail-label"},"Terisi:",-1)),a("span",sa,[a("span",aa,n(v.value.terisi)+" tempat tidur",1)])]),a("div",ea,[s[28]||(s[28]=a("span",{class:"detail-label"},"Persentase Terisi:",-1)),a("span",ta,n(v.value.persentase_terisi)+"%",1)])])):T("",!0)])])):T("",!0)]))}},ca=is(la,[["__scopeId","data-v-faa83b26"]]);export{ca as default};
