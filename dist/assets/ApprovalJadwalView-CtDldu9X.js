import{r as c,c as f,o as ie,w as re,a as r,b as t,e as V,j as T,A as ue,B as de,D as y,F as p,f as b,z as ce,t as o,i as u,n as g}from"./vendor-abe1rO6K.js";import{j as x}from"./jadwalPegawaiService-C8wkHlFU.js";import{_ as me,u as ve}from"./index-CXPIpl-L.js";import{S as A}from"./SearchableSelect-Lnl9dbY0.js";import"./api-B9ygI19o.js";const he={class:"jadwal-page"},fe={class:"page-header"},pe={class:"controls"},be={class:"filter-group"},ge={key:0,class:"loading-state"},ye={key:1,class:"table-container"},we={class:"table-wrapper"},_e={class:"schedule-table"},ke={class:"day-name"},Se={class:"sticky-col name-col"},Ce={class:"employee-info"},je={class:"emp-name"},De={class:"emp-dept"},Je={class:"stats-cell"},Me={class:"stats-cell"},Pe={class:"stats-cell"},Ve={class:"stats-cell font-bold"},Te={class:"stats-cell"},xe={class:"stats-cell"},Ae={class:"stats-cell"},Le={key:2,class:"summary-section"},Oe={class:"table-container summary-table-container"},Fe={class:"table-wrapper"},Ne={class:"schedule-table summary-table"},$e={class:"sticky-col name-col shift-label"},Be={class:"floating-actions"},Ee=["disabled"],Re={key:0,class:"fas fa-spinner fa-spin"},ze={key:1,class:"fas fa-check-circle"},Ue={key:2},He={class:"modal-content"},Ie={class:"modal-body"},Ge={class:"modal-context"},Ke={class:"shift-grid"},Ye=["onClick"],qe={class:"shift-code"},Qe={class:"shift-time"},We={class:"shift-name"},Xe={__name:"ApprovalJadwalView",setup(Ze){ve();const L=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"],k=new Date().getFullYear(),H=[k-1,k,k+1],n=c({month:new Date().getMonth()+1,year:k,search:"",department:"all"}),O=c([]),h=c(!1),w=c(!1),S=c([]),F=c([]),N=c(!1),_=c({}),$=c(!1),C=c(null),j=c(null),m=f(()=>new Date(n.value.year,n.value.month,0).getDate()),I=f(()=>{const s=O.value.map(e=>({id:e.id,name:e.name}));return[{id:"all",name:"Semua Departemen"},...s]}),G=f(()=>L.map((s,e)=>({id:e+1,name:s}))),K=f(()=>H.map(s=>({id:s,name:s.toString()}))),B=f(()=>S.value),Y=["Pagi","Siang","Malam","Cuti"],q=f(()=>{const s={};return Y.forEach(e=>{s[e]={};for(let l=1;l<=m.value;l++)s[e][l]=0}),B.value.forEach(e=>{for(let l=1;l<=m.value;l++){const a=v(e,l);if(a){let i=null;const d=a.toLowerCase();d.includes("pagi")?i="Pagi":d.includes("siang")?i="Siang":d.includes("malam")?i="Malam":d.includes("cuti")&&(i="Cuti"),i&&s[i][l]++}}}),s});f(()=>Object.keys(_.value).length);const Q=(s,e)=>v(s,e)||"-",D=(s,e)=>{let l=0;for(let a=1;a<=m.value;a++){const i=v(s,a);i&&i.toLowerCase().includes(e.toLowerCase())&&l++}return l},W=s=>{let e=0;for(let l=1;l<=m.value;l++){const a=v(s,l);a&&a!=="-"&&!a.toLowerCase().includes("cuti")&&e++}return e},X=s=>{let e=0;for(let l=1;l<=m.value;l++){const a=v(s,l);(!a||a==="-")&&e++}return e},Z={pagi:7,siang:7,malam:10},E=s=>{let e=0;for(let l=1;l<=m.value;l++){const a=v(s,l);if(a){const i=a.toLowerCase();let d=!1;for(const[ne,oe]of Object.entries(Z))if(i.includes(ne)){e+=oe,d=!0;break}!d&&!i.includes("cuti")&&a!=="-"&&(e+=7)}}return e},R=s=>E(s)-173,ee=s=>R(s)>=0?"text-green-600":"text-red-600",te=s=>{switch(s){case"Pagi":return"row-blue";case"Siang":return"row-yellow";case"Malam":return"row-blue";case"Cuti":return"row-yellow";default:return""}},J=s=>new Date(n.value.year,n.value.month-1,s).getDay()===0,z=s=>{const e=new Date(n.value.year,n.value.month-1,s);return["Min","Sen","Sel","Rab","Kam","Jum","Sab"][e.getDay()]},M=async()=>{h.value=!0,S.value=[],_.value={},N.value=!1;try{const[s,e]=await Promise.all([x.getSchedule(n.value.month,n.value.year,n.value.department,n.value.search),x.getShifts()]);s.data&&(s.data.data&&(S.value=s.data.data),s.data.authorized_departments&&(O.value=s.data.authorized_departments)),e.data&&e.data.data&&(F.value=e.data.data)}catch(s){console.error("Failed to load schedule",s),alert("Gagal memuat data jadwal.")}finally{h.value=!1}},ae=()=>{setTimeout(()=>{M()},500)},v=(s,e)=>{const l=`${s.id}_${e}`;if(_.value[l]!==void 0)return _.value[l];if(s.jadwal){const a=`h${e}`;return s.jadwal[a]}return null},se=s=>{if(!s)return"bg-gray-100";const e=s.toLowerCase();return e.includes("pagi")?"shift-pagi":e.includes("siang")?"shift-siang":e.includes("malam")?"shift-malam":e.includes("cuti")?"shift-cuti":e.includes("libur")?"shift-libur":e.includes("midle")?"shift-midle":"shift-default"},P=()=>{$.value=!1,C.value=null,j.value=null},U=s=>{if(C.value&&j.value){const e=`${C.value.id}_${j.value}`;_.value[e]=s,N.value=!0}P()},le=async()=>{var s,e;if(confirm("Apakah Anda yakin ingin menyetujui dan mempublikasikan jadwal ini? Action ini akan memperbarui Jadwal Final.")){w.value=!0;try{const l=await x.approveSchedule(n.value.month,n.value.year,n.value.department);if(l.status===200)alert("Jadwal berhasil disetujui & dipublikasikan!");else throw new Error(l.data.message||"Gagal approve")}catch(l){console.error("Approve failed",l),alert("Gagal menyetujui jadwal: "+(((e=(s=l.response)==null?void 0:s.data)==null?void 0:e.message)||l.message))}finally{w.value=!1}}};return ie(()=>{M()}),re([()=>n.value.month,()=>n.value.year,()=>n.value.department],()=>{M()}),(s,e)=>{var l;return u(),r("div",he,[t("div",fe,[e[6]||(e[6]=t("h2",null,"✅ Approval Jadwal Pegawai",-1)),t("div",pe,[t("div",be,[T(A,{modelValue:n.value.department,"onUpdate:modelValue":e[0]||(e[0]=a=>n.value.department=a),options:I.value,placeholder:"Semua Departemen",class:"dept-select",disabled:h.value},null,8,["modelValue","options","disabled"]),T(A,{modelValue:n.value.month,"onUpdate:modelValue":e[1]||(e[1]=a=>n.value.month=a),options:G.value,placeholder:"Pilih Bulan",class:"month-select",disabled:h.value},null,8,["modelValue","options","disabled"]),T(A,{modelValue:n.value.year,"onUpdate:modelValue":e[2]||(e[2]=a=>n.value.year=a),options:K.value,placeholder:"Pilih Tahun",class:"year-select",disabled:h.value},null,8,["modelValue","options","disabled"]),ue(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>n.value.search=a),type:"text",placeholder:"Cari Pegawai...",class:"form-input search-input",onInput:ae},null,544),[[de,n.value.search]]),t("button",{onClick:M,class:"btn btn-primary"},[...e[5]||(e[5]=[t("i",{class:"fas fa-sync-alt"},null,-1),y(" Refresh ",-1)])])])])]),h.value?(u(),r("div",ge,[...e[7]||(e[7]=[t("div",{class:"spinner"},null,-1),t("p",null,"Memuat data jadwal...",-1)])])):(u(),r("div",ye,[t("div",we,[t("table",_e,[t("thead",null,[t("tr",null,[e[8]||(e[8]=t("th",{class:"sticky-col name-col"},[t("span",{class:"desktop-text"},"Nama Pegawai / Departemen"),t("span",{class:"mobile-text"},"Pegawai")],-1)),(u(!0),r(p,null,b(m.value,a=>(u(),r("th",{key:a,class:g([{sunday:J(a)},"date-col"])},[y(o(a)+" ",1),t("div",ke,o(z(a)),1)],2))),128)),e[9]||(e[9]=t("th",{class:"stats-header"},"Pagi",-1)),e[10]||(e[10]=t("th",{class:"stats-header"},"Siang",-1)),e[11]||(e[11]=t("th",{class:"stats-header"},"Malam",-1)),e[12]||(e[12]=t("th",{class:"stats-header"},"Total",-1)),e[13]||(e[13]=t("th",{class:"stats-header"},"Libur",-1)),e[14]||(e[14]=t("th",{class:"stats-header"},"Cuti",-1)),e[15]||(e[15]=t("th",{class:"stats-header"},"Jumlah Jam",-1)),e[16]||(e[16]=t("th",{class:"stats-header"},"Kewajiban Jam",-1)),e[17]||(e[17]=t("th",{class:"stats-header"},"Lebih Jam",-1))])]),t("tbody",null,[(u(!0),r(p,null,b(B.value,a=>(u(),r("tr",{key:a.id},[t("td",Se,[t("div",Ce,[t("span",je,o(a.nama),1),t("span",De,o(a.departemen),1)])]),(u(!0),r(p,null,b(m.value,i=>(u(),r("td",{key:i,class:g(["shift-cell shift-cell-readonly",{sunday:J(i),"has-shift":v(a,i)&&v(a,i)!=="-"}])},o(Q(a,i)),3))),128)),t("td",Je,o(D(a,"Pagi")),1),t("td",Me,o(D(a,"Siang")),1),t("td",Pe,o(D(a,"Malam")),1),t("td",Ve,o(W(a)),1),t("td",Te,o(X(a)),1),t("td",xe,o(D(a,"Cuti")),1),t("td",Ae,o(E(a))+" Jam",1),e[18]||(e[18]=t("td",{class:"stats-cell font-bold"},"173 Jam",-1)),t("td",{class:g(["stats-cell font-bold",ee(a)])},o(R(a))+" Jam",3)]))),128))])])])])),!h.value&&S.value.length>0?(u(),r("div",Le,[e[21]||(e[21]=t("h3",null,"Jumlah Shift Per Tanggal",-1)),t("div",Oe,[t("div",Fe,[t("table",Ne,[t("thead",null,[t("tr",null,[e[20]||(e[20]=t("th",{class:"sticky-col name-col"},"Shift",-1)),(u(!0),r(p,null,b(m.value,a=>(u(),r("th",{key:a,class:g([{sunday:J(a)},"date-col"])},[y(o(a)+" ",1),e[19]||(e[19]=t("br",null,null,-1)),y(" "+o(z(a)),1)],2))),128))])]),t("tbody",null,[(u(!0),r(p,null,b(q.value,(a,i)=>(u(),r("tr",{key:i,class:g(te(i))},[t("td",$e,o(i),1),(u(!0),r(p,null,b(m.value,d=>(u(),r("td",{key:d,class:g(["summary-cell",{sunday:J(d)}])},o(a[d]||0),3))),128))],2))),128))])])])])])):V("",!0),t("div",Be,[t("button",{onClick:le,class:"btn btn-approve",disabled:w.value},[w.value?(u(),r("i",Re)):(u(),r("i",ze)),w.value?V("",!0):(u(),r("span",Ue,"Setujui & Publikasikan"))],8,Ee)]),$.value?(u(),r("div",{key:3,class:"modal-overlay",onClick:ce(P,["self"])},[t("div",He,[t("div",{class:"modal-header"},[e[22]||(e[22]=t("h3",null,"Pilih Shift",-1)),t("button",{onClick:P,class:"close-btn"},"×")]),t("div",Ie,[t("p",Ge,[t("strong",null,o((l=C.value)==null?void 0:l.nama),1),e[23]||(e[23]=y()),e[24]||(e[24]=t("br",null,null,-1)),y(" Tanggal: "+o(j.value)+" "+o(L[n.value.month-1])+" "+o(n.value.year),1)]),t("div",Ke,[t("button",{class:"shift-btn clear-btn",onClick:e[4]||(e[4]=a=>U(null))}," ❌ Hapus / Kosong "),(u(!0),r(p,null,b(F.value,a=>(u(),r("button",{key:a.shift,class:g(["shift-btn",se(a.shift)]),onClick:i=>U(a.shift)},[t("div",qe,o(a.shift),1),t("div",Qe,o(a.jam_masuk)+" - "+o(a.jam_pulang),1),t("div",We,o(a.nama_shift||"Shift"),1)],10,Ye))),128))])])])])):V("",!0)])}}},nt=me(Xe,[["__scopeId","data-v-5e16bb8f"]]);export{nt as default};
