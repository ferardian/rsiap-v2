import{r as v,c as w,o as I,a as l,b as t,e as g,A as V,B as U,F as L,f as Y,D as d,t as s,z as G,i as o}from"./vendor-abe1rO6K.js";import{_ as z,a as J}from"./index-CXPIpl-L.js";import{pegawaiService as M}from"./pegawaiService-B330j5v3.js";import"./api-B9ygI19o.js";const Q={class:"karyawan-container"},q={class:"page-header"},O={class:"header-actions"},R={class:"search-box"},W={key:0,class:"loading-state"},X={key:1,class:"table-container"},Z={class:"table-wrapper"},tt={class:"data-table"},at={class:"employee-profile"},et={class:"avatar"},nt=["src"],st={key:1,class:"initials"},lt={class:"employee-info"},ot={class:"emp-name"},rt={class:"emp-role"},it={class:"nip-text"},ut={class:"ttl"},dt={class:"alamat-cell"},ct={class:"tenure-badge"},pt={class:"action-buttons"},vt=["onClick"],mt=["onClick"],gt={key:2,class:"empty-state"},ft={key:3,class:"pagination"},ht=["disabled"],yt={class:"page-info"},_t=["disabled"],kt={class:"modal-header"},bt={class:"modal-body"},wt={class:"modal-footer"},D=23,Mt={__name:"KaryawanView",setup(Dt){const k=J(),c=v(!1),f=v(""),h=v([]),r=v({current_page:1,last_page:1,per_page:50,total:0}),p=v(!1),b=v(null),$=w(()=>k.hasMenuPermission(D,"can_create")),P=w(()=>k.hasMenuPermission(D,"can_update")),j=w(()=>k.hasMenuPermission(D,"can_delete")),y=async(n=1)=>{c.value=!0;try{const a=await M.getPegawai(n,50);a.data.success&&(h.value=a.data.data,r.value=a.data.pagination)}catch(a){console.error("Error loading pegawai:",a),alert("Gagal memuat data karyawan")}finally{c.value=!1}},N=async()=>{if(f.value.trim().length<2){y();return}c.value=!0;try{const n=await M.searchPegawai(f.value);n.data.success&&(h.value=n.data.data,r.value={current_page:1,last_page:1,per_page:n.data.data.length,total:n.data.data.length})}catch(n){console.error("Error searching pegawai:",n)}finally{c.value=!1}},C=n=>{y(n)},T=()=>{alert("Fitur tambah karyawan akan segera ditambahkan")},x=n=>{alert(`Edit karyawan: ${n.nama}`)},E=n=>{b.value=n,p.value=!0},K=async()=>{try{(await M.deletePegawai(b.value.nip)).data.success&&(alert("Karyawan berhasil dihapus"),p.value=!1,y(r.value.current_page))}catch(n){console.error("Error deleting pegawai:",n),alert("Gagal menghapus karyawan")}},F=n=>`/storage/pegawai/${n}`,S=n=>{if(!n)return"-";const a=new Date(n),u=String(a.getDate()).padStart(2,"0"),e=String(a.getMonth()+1).padStart(2,"0"),i=a.getFullYear();return`${u}-${e}-${i}`},A=n=>{if(!n)return"-";const a=new Date(n),u=new Date;if(isNaN(a.getTime()))return"-";let e=u.getFullYear()-a.getFullYear(),i=u.getMonth()-a.getMonth(),_=u.getDate()-a.getDate();if(_<0){i--;const H=new Date(u.getFullYear(),u.getMonth(),0);_+=H.getDate()}i<0&&(e--,i+=12);const m=[];return e>0&&m.push(`${e} Tahun`),i>0&&m.push(`${i} Bulan`),_>0&&m.push(`${_} Hari`),m.length===0?"0 Hari":m.join(" ")},B=n=>n?n.match(/(^\S\S?|\s\S)?/g).map(a=>a.trim()).join("").match(/(^\S|\S$)?/g).join("").toLocaleUpperCase().substring(0,2):"?";return I(()=>{y()}),(n,a)=>{var u;return o(),l("div",Q,[t("div",q,[t("div",O,[t("div",R,[a[8]||(a[8]=t("i",{class:"fas fa-search"},null,-1)),V(t("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>f.value=e),onInput:N,placeholder:"Cari nama, NIP, atau jabatan..."},null,544),[[U,f.value]])]),$.value?(o(),l("button",{key:0,class:"btn-add",onClick:T},[...a[9]||(a[9]=[t("i",{class:"fas fa-plus"},null,-1),t("span",null,"Tambah Karyawan",-1)])])):g("",!0)])]),c.value?(o(),l("div",W,[...a[10]||(a[10]=[t("i",{class:"fas fa-spinner fa-spin"},null,-1),t("p",null,"Memuat data...",-1)])])):!c.value&&h.value.length>0?(o(),l("div",X,[t("div",Z,[t("table",tt,[a[14]||(a[14]=t("thead",null,[t("tr",null,[t("th",null,"Nama"),t("th",null,"NIP"),t("th",null,"Jenis Kelamin"),t("th",null,"TTL"),t("th",null,"Alamat"),t("th",null,"Pendidikan"),t("th",null,"No. KTP"),t("th",null,"No. Telp"),t("th",null,"Departemen"),t("th",null,"Mulai Kerja"),t("th",null,"Masa Kerja"),t("th",null,"Aksi")])],-1)),t("tbody",null,[(o(!0),l(L,null,Y(h.value,e=>(o(),l("tr",{key:e.nip},[t("td",null,[t("div",at,[t("div",et,[e.photo?(o(),l("img",{key:0,src:F(e.photo),alt:"Foto",onError:a[1]||(a[1]=i=>i.target.style.display="none")},null,40,nt)):(o(),l("span",st,s(B(e.nama)),1))]),t("div",lt,[t("span",ot,s(e.nama),1),t("span",rt,s(e.jbtn||"-"),1)])])]),t("td",null,[t("span",it,s(e.nip),1)]),t("td",null,s(e.jk||"-"),1),t("td",null,[t("div",ut,[d(s(e.tmp_lahir||"-")+",",1),a[11]||(a[11]=t("br",null,null,-1)),d(" "+s(S(e.tgl_lahir)),1)])]),t("td",null,[t("div",dt,s(e.alamat||"-"),1)]),t("td",null,s(e.pendidikan||"-"),1),t("td",null,s(e.no_ktp||"-"),1),t("td",null,s(e.no_telp||"-"),1),t("td",null,s(e.departemen||"-"),1),t("td",null,s(S(e.mulai_kerja)),1),t("td",null,[t("span",ct,s(A(e.mulai_kerja)),1)]),t("td",null,[t("div",pt,[P.value?(o(),l("button",{key:0,class:"btn-edit",onClick:i=>x(e),title:"Edit"},[...a[12]||(a[12]=[t("i",{class:"fas fa-edit"},null,-1)])],8,vt)):g("",!0),j.value?(o(),l("button",{key:1,class:"btn-delete",onClick:i=>E(e),title:"Hapus"},[...a[13]||(a[13]=[t("i",{class:"fas fa-trash"},null,-1)])],8,mt)):g("",!0)])])]))),128))])])])])):(o(),l("div",gt,[...a[15]||(a[15]=[t("i",{class:"fas fa-users"},null,-1),t("p",null,"Tidak ada data karyawan",-1)])])),r.value.total>0?(o(),l("div",ft,[t("button",{class:"btn-page",disabled:r.value.current_page===1,onClick:a[2]||(a[2]=e=>C(r.value.current_page-1))},[...a[16]||(a[16]=[t("i",{class:"fas fa-chevron-left"},null,-1),d(" Sebelumnya ",-1)])],8,ht),t("span",yt," Halaman "+s(r.value.current_page)+" dari "+s(r.value.last_page)+" ("+s(r.value.total)+" total) ",1),t("button",{class:"btn-page",disabled:r.value.current_page===r.value.last_page,onClick:a[3]||(a[3]=e=>C(r.value.current_page+1))},[...a[17]||(a[17]=[d(" Selanjutnya ",-1),t("i",{class:"fas fa-chevron-right"},null,-1)])],8,_t)])):g("",!0),p.value?(o(),l("div",{key:4,class:"modal-overlay",onClick:a[7]||(a[7]=e=>p.value=!1)},[t("div",{class:"modal-content",onClick:a[6]||(a[6]=G(()=>{},["stop"]))},[t("div",kt,[a[19]||(a[19]=t("h3",null,"Konfirmasi Hapus",-1)),t("button",{class:"btn-close",onClick:a[4]||(a[4]=e=>p.value=!1)},[...a[18]||(a[18]=[t("i",{class:"fas fa-times"},null,-1)])])]),t("div",bt,[t("p",null,[a[20]||(a[20]=d("Apakah Anda yakin ingin menghapus karyawan ",-1)),t("strong",null,s((u=b.value)==null?void 0:u.nama),1),a[21]||(a[21]=d("?",-1))]),a[22]||(a[22]=t("p",{class:"warning-text"},"Data yang dihapus tidak dapat dikembalikan.",-1))]),t("div",wt,[t("button",{class:"btn-cancel",onClick:a[5]||(a[5]=e=>p.value=!1)},"Batal"),t("button",{class:"btn-confirm-delete",onClick:K},[...a[23]||(a[23]=[t("i",{class:"fas fa-trash"},null,-1),d(" Hapus ",-1)])])])])])):g("",!0)])}}},jt=z(Mt,[["__scopeId","data-v-255ee3b3"]]);export{jt as default};
